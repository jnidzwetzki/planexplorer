(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{131:e=>{e.exports={sqlBox:"SqlQueryInput_sqlBox__aXeGu",sqlLabel:"SqlQueryInput_sqlLabel__jEOgL",sqlTextarea:"SqlQueryInput_sqlTextarea__FNuM_",sqlHint:"SqlQueryInput_sqlHint__TQLcQ",sqlPlaceholderBtn:"SqlQueryInput_sqlPlaceholderBtn__iM5CO",experimentBox:"SqlQueryInput_experimentBox__uKgoo",experimentTitle:"SqlQueryInput_experimentTitle__gYOFZ",experimentCheckboxLabel:"SqlQueryInput_experimentCheckboxLabel__xDqLh",experimentCheckbox:"SqlQueryInput_experimentCheckbox__Hy34X",experimentGroupTitle:"SqlQueryInput_experimentGroupTitle__ys1JO"}},2789:e=>{e.exports={selectorRow:"DatabaseSelector_selectorRow__2xj6A",selectorRowInner:"DatabaseSelector_selectorRowInner__SgM8G",selectorLabel:"DatabaseSelector_selectorLabel__xa_gL",selectorSelect:"DatabaseSelector_selectorSelect__VZ5g3",inputProxyUrl:"DatabaseSelector_inputProxyUrl__sJttg",buttonTestRow:"DatabaseSelector_buttonTestRow__YBFYQ",selectorBox:"DatabaseSelector_selectorBox__aDp06",dimensionLegend:"DatabaseSelector_dimensionLegend__KvjjH",buttonTest:"DatabaseSelector_buttonTest__nGHyY",testStatusBox:"DatabaseSelector_testStatusBox__29of9",testStatusSuccess:"DatabaseSelector_testStatusSuccess__gWbBL",testStatusError:"DatabaseSelector_testStatusError__5kmME"}},2836:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>eu});var a=r(5155),n=r(2115),s=r(6677),l=r.n(s);function i(e){let{label:t,start:r,end:s,setStart:i,setEnd:o,startValid:c,setStartValid:u,endValid:p,setEndValid:d,step:m,setStep:y,description:h,setDescription:x,onRemove:f}=e,[_,g]=n.useState(r.toString()),[b,S]=n.useState(s.toString()),[N,j]=n.useState(m.toString()),[v,E]=n.useState(!0),[A,w]=n.useState(h);n.useEffect(()=>{g(r.toString())},[r]),n.useEffect(()=>{S(s.toString())},[s]),n.useEffect(()=>{j(m.toString())},[m]),n.useEffect(()=>{w(h)},[h]);let F=e=>""!==e&&"-"!==e&&/^-?\d+$/.test(e),L=e=>""!==e&&/^\d*\.?\d+$/.test(e)&&Number(e)>0,R=(e,t)=>!(F(e)&&F(t))||Number(t)>Number(e);return(0,a.jsxs)("fieldset",{className:l().dimensionGroup,children:[(0,a.jsxs)("legend",{className:l().dimensionLegend,children:[t,"Dimension 1"===t&&f&&(0,a.jsx)("button",{type:"button",className:l().removeButton,title:"Remove Dimension 1",onClick:f,"aria-label":"Remove Dimension 1",children:"\xd7"})]}),(0,a.jsxs)("div",{className:l().intervalRow,children:[(0,a.jsxs)("label",{className:l().inputLabel,children:[(0,a.jsx)("span",{children:"Start"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:_,onChange:e=>{let t=e.target.value;g(t);let r=F(t);u(r),r&&F(b)&&d(F(b)&&R(t,b)),r&&i(Number(t))},className:c?l().inputField:"".concat(l().inputField," ").concat(l().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:l().inputLabel,children:[(0,a.jsx)("span",{children:"End"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:b,onChange:e=>{let t=e.target.value;S(t);let r=F(t)&&R(_,t);d(r),F(_)&&u(F(_)),r&&o(Number(t))},className:p?l().inputField:"".concat(l().inputField," ").concat(l().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:l().inputLabel,children:[(0,a.jsx)("span",{children:"Step"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:N,onChange:e=>{let t=e.target.value;j(t);let r=L(t);E(r),r&&y(Number(t))},className:v?l().inputField:"".concat(l().inputField," ").concat(l().inputFieldInvalid),min:1})]}),(0,a.jsxs)("label",{className:l().inputLabel,style:{marginLeft:8},children:[(0,a.jsx)("span",{children:"Description"}),(0,a.jsx)("input",{type:"text",value:A,onChange:e=>{let t=e.target.value;w(t),x(t)},className:l().inputField})]})]})]})}var o=r(131),c=r.n(o);let u="SET enable_seqscan = on;\nSET cpu_index_tuple_cost = 0.0005;\nDROP TABLE IF EXISTS data;\nCREATE TABLE data(key integer, value text);\nINSERT INTO data (key, value) SELECT i, i::text FROM generate_series(1, 100000) i;\nCREATE INDEX ON data(key);\nANALYZE data;",p="SELECT * FROM data WHERE key > %%DIMENSION0%%;";function d(e){let{value:t,onChange:r,dim1Active:s,preparationValue:l,onPreparationChange:i,executeQueries:o=!1,onExecuteQueriesChange:u,showExperimentGroup:p}=e,d=(0,n.useRef)(null),m=e=>{let a=d.current;if(!a)return;let n=a.selectionStart,s=a.selectionEnd;r(t.slice(0,n)+e+t.slice(s)),setTimeout(()=>{a.focus(),a.selectionStart=a.selectionEnd=n+e.length},0)};return(0,a.jsxs)("div",{className:c().sqlBox,children:[(0,a.jsx)("label",{htmlFor:"preparation-steps",className:c().sqlLabel,children:"Preparation Steps"}),(0,a.jsx)("textarea",{id:"preparation-steps",value:l,onChange:e=>i(e.target.value),rows:7,className:c().sqlTextarea,placeholder:"Describe any preparation steps here..."}),(0,a.jsx)("label",{htmlFor:"sql-query",className:c().sqlLabel,children:"SQL Query"}),(0,a.jsx)("textarea",{id:"sql-query",ref:d,value:t,onChange:e=>r(e.target.value),rows:3,className:c().sqlTextarea,placeholder:"Enter your SQL query here..."}),(0,a.jsxs)("div",{className:c().sqlHint,children:["You can use the placeholder"," ",(0,a.jsx)("button",{type:"button",className:c().sqlPlaceholderBtn,onClick:()=>m("%%DIMENSION0%%"),children:"%%DIMENSION0%%"}),s&&(0,a.jsxs)(a.Fragment,{children:[" ","and"," ",(0,a.jsx)("button",{type:"button",className:c().sqlPlaceholderBtn,onClick:()=>m("%%DIMENSION1%%"),children:"%%DIMENSION1%%"})]})," ","in your query."]}),p&&(0,a.jsxs)("fieldset",{className:c().experimentBox,children:[(0,a.jsx)("legend",{className:c().dimensionLegend,style:{marginBottom:0},children:"Experiment"}),(0,a.jsxs)("label",{className:c().experimentCheckboxLabel,children:[(0,a.jsx)("input",{type:"checkbox",className:c().experimentCheckbox,checked:o,onChange:e=>null==u?void 0:u(e.target.checked)}),(0,a.jsx)("span",{title:"Without this option, the queries are just planned",children:"Execute Queries"})]})]})]})}var m=r(9967);let y=new Map,h=new Map,x=1,f=new Map;function _(){y.clear(),h.clear(),x=1,f=new Map}function g(e,t){let r;return y.has(e)?r=y.get(e):(r=x++,y.set(e,r),h.set(r,"string"==typeof t?t:JSON.stringify(t,null,2))),r}function b(e,t,r){let a=g(function(e){let t=[];return Array.isArray(e)&&e.length>0&&e[0].Plan&&function e(t,r){if(!t||"object"!=typeof t)return;let a="string"==typeof t["Node Type"]?t["Node Type"]:void 0,n="string"==typeof t.Alias?t.Alias:void 0,s="string"==typeof t["Relation Name"]?t["Relation Name"]:void 0;if(a){let e=a;(n||s)&&(e+="(",n?e+=n:s&&(e+=s),e+=")"),r.push(e)}for(let a in t){let n=t[a];Array.isArray(n)?n.forEach(t=>e(t,r)):"object"==typeof n&&null!==n&&e(n,r)}}(e[0].Plan,t),t.join(">")}(e),e);t&&r.set(t,a)}function S(e){return e.split(";").map(e=>e.trim()).filter(Boolean)}function N(e){return e.trim().toUpperCase().startsWith("SELECT")}async function j(e,t){let r,a=[];for(let n of S(e))try{let{ok:e,data:s}=await t(n);e?a.push({query:n,result:s}):(r||(r="".concat(n,";\nError: ").concat(s.error)),a.push({query:n,error:s.error,result:s}))}catch(e){r||(r="".concat(n,";\nError: ").concat(e instanceof Error?e.message:String(e))),a.push({query:n,error:e instanceof Error?e.message:String(e)})}return{results:a,firstError:r}}function v(e,t,r){return e.replaceAll("%%DIMENSION0%%",t).replaceAll("%%DIMENSION1%%",r)}async function E(e){let{dim1Active:t,start0:r,end0:a,step0:n,start1:s,end1:l,step1:i,sqlQuery:o,callback:c,onProgress:u}=e,p=0;if(t)for(let e=r;e<=a+1e-8;e+=n){let t=Number(e.toFixed(8));for(let e=s;e<=l+1e-8;e+=i){let r=Number(e.toFixed(8)),a=v(o,t.toString(),r.toString()),n="".concat(t,",").concat(r);await c({sql:a,combinationKey:n,iFixed:t,jFixed:r,executionIndex:p}),u&&u(p+1),p++}}else for(let e=r;e<=a+1e-8;e+=n){let t=Number(e.toFixed(8)),r=v(o,t.toString(),""),a="".concat(t,",0");await c({sql:r,combinationKey:a,iFixed:t,jFixed:0,executionIndex:p}),u&&u(p+1),p++}}function A(e,t,r,a,n,s,l){let i=0;if(e)for(let e=t;e<=r+1e-8;e+=a)for(let e=n;e<=s+1e-8;e+=l)i++;else for(let e=t;e<=r+1e-8;e+=a)i++;return i}async function w(e){let{sql:t,combinationKey:r,planFingerprintByCombination:a,proxyUrl:n,handleExplainResult:s,sqlResults:l,executeQueries:i,backend:o}=e;for(let e of S(t)){let t=e,c=!1;N(e)&&(t="mysql"===o?"EXPLAIN FORMAT=JSON ".concat(e):i?"EXPLAIN (ANALYZE, FORMAT JSON) ".concat(e):"EXPLAIN (FORMAT JSON) ".concat(e),c=!0);try{let e=await fetch("".concat(n,"/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:t,backend:o})}),i=await e.json();if(e.ok){if(c)try{if("mysql"===o){let e=i.rows,t=Array.isArray(e)&&e.length>0?e[0]:void 0,n=t&&t.EXPLAIN;n&&s(n,r,a)}else{let e=i.rows,t=Array.isArray(e)&&e.length>0?e[0]:void 0,n=t&&Object.values(t)[0];n&&s(n,r,a)}}catch(e){}l.push({query:t,result:i,combinationKey:r})}else l.push({query:t,error:i.error,result:i,combinationKey:r})}catch(e){l.push({query:t,error:e instanceof Error?e.message:String(e),combinationKey:r})}}}function F(e,t,r){let a,n=e;if("string"==typeof e)try{n=JSON.parse(e)}catch(e){n={query_block:{}}}a=n&&"object"==typeof n&&"query_block"in n&&n.query_block&&"object"==typeof n.query_block?n.query_block:n&&"object"==typeof n?n:void 0;let s=[];!function e(t,r){if(t){if("nested_loop"in t&&Array.isArray(t.nested_loop))r.push("nested_loop"),t.nested_loop.forEach(t=>e(t,r));else if("table"in t&&"object"==typeof t.table){let e=t.table.access_type||"";r.push("table:".concat(e))}else if("object"==typeof t&&null!==t)for(let a in t)Object.prototype.hasOwnProperty.call(t,a)&&e(t[a],r)}}(a,s);let l=g(s.join(">"),n);t&&r.set(t,l)}async function L(e){return"proxy"===e.backend||"mysql"===e.backend?R(e):k(e)}async function R(e){let t,{dim1Active:r,start0:a,end0:n,step0:s,start1:l,end1:i,step1:o,sqlQuery:c,preparation:u,proxyUrl:p="http://localhost:4000",backend:d}=e;f.clear();let{onProgress:m}=e,y=[];if(u){let e=await j(u,async e=>{let t=await fetch("".concat(p,"/query"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({sql:e,backend:d})}),r=await t.json();return{ok:t.ok,data:r}});y=e.results,t=e.firstError}let h=[],x=A(r,a,n,s,l,i,o);return await E({dim1Active:r,start0:a,end0:n,step0:s,start1:l,end1:i,step1:o,sqlQuery:c,callback:async t=>{let{sql:r,combinationKey:a}=t;await w({sql:r,combinationKey:a,planFingerprintByCombination:f,proxyUrl:p,handleExplainResult:"mysql"===d?F:b,sqlResults:h,executeQueries:e.executeQueries,backend:d})},onProgress:m?e=>m(e,x):void 0}),{preparationResults:y,sqlResults:h,error:t}}async function T(e){let{db:t,sql:r,combinationKey:a,planFingerprintByCombination:n,handleExplainResult:s,sqlResults:l,executeQueries:i}=e;for(let e of S(r)){let r=e,o=!1;N(e)&&(r=i?"EXPLAIN (ANALYZE, FORMAT JSON) ".concat(e):"EXPLAIN (FORMAT JSON) ".concat(e),o=!0);try{let e=await t.query(r);if(o)try{let t=e.rows,r=Array.isArray(t)&&t.length>0?t[0]:void 0,l=r&&Object.values(r)[0];l&&s(l,a,n)}catch(e){window.console.log("Explain JSON parse error:",e)}l.push({query:r,result:e,combinationKey:a})}catch(e){l.push({query:r,error:e instanceof Error?e.message:String(e),combinationKey:a})}}}async function k(e){let t,{dim1Active:r,start0:a,end0:n,step0:s,start1:l,end1:i,step1:o,sqlQuery:c,preparation:u}=e;f.clear();let p=new m.Eb,{onProgress:d}=e,y=[];if(u){let e=await j(u,async e=>{try{let t=await p.query(e);return{ok:!0,data:t}}catch(e){return{ok:!1,data:{error:e instanceof Error?e.message:String(e)}}}});y=e.results,t=e.firstError}let h=[],x=A(r,a,n,s,l,i,o);return await E({dim1Active:r,start0:a,end0:n,step0:s,start1:l,end1:i,step1:o,sqlQuery:c,callback:async t=>{let{sql:r,combinationKey:a}=t;await T({db:p,sql:r,combinationKey:a,planFingerprintByCombination:f,handleExplainResult:b,sqlResults:h,executeQueries:e.executeQueries})},onProgress:d?e=>d(e,x):void 0}),{preparationResults:y,sqlResults:h,error:t}}var C=r(2789),I=r.n(C);let q=e=>{let{value:t,onChange:r,proxyUrl:s,onProxyUrlChange:l}=e,[i,o]=(0,n.useState)(null),[c,u]=(0,n.useState)("");async function p(){if(!s)return;o("loading"),u("");let e=new AbortController,r=setTimeout(()=>e.abort(),5e3);try{let a="";"mysql"===t?a="?backend=mysql":"proxy"===t&&(a="?backend=proxy");let n=await fetch("".concat(s.replace(/\/$/,""),"/ping").concat(a),{signal:e.signal});if(clearTimeout(r),n.ok){let e=await n.json();e.ok?(o("success"),u("Connection successful!")):(o("error"),u(e.error?"Server error: ".concat(e.error):"Unknown error"))}else{o("error");let e="HTTP error: ".concat(n.status);try{let t=await n.json();t&&t.error&&(e="Server error: ".concat(t.error))}catch(e){}u(e)}}catch(e){clearTimeout(r),e instanceof DOMException&&"AbortError"===e.name?(o("error"),u("Connection timed out (5s)")):e instanceof Error?(o("error"),u(e.message)):(o("error"),u(String(e)))}}return(0,a.jsxs)("fieldset",{className:I().selectorBox,children:[(0,a.jsx)("legend",{className:I().dimensionLegend,style:{marginBottom:0},children:"Database Backend"}),(0,a.jsxs)("div",{className:I().selectorRow,children:[(0,a.jsx)("div",{className:I().selectorRowInner,children:(0,a.jsxs)("select",{id:"db-backend-select",className:I().selectorSelect,value:t,onChange:e=>r(e.target.value),children:[(0,a.jsx)("option",{value:"pglite",children:"Built-in (PGLite, in-browser)"}),(0,a.jsx)("option",{value:"proxy",children:"Server Proxy (PostgreSQL, proxy backend)"}),(0,a.jsx)("option",{value:"mysql",children:"Server Proxy (MySQL, proxy backend)"})]})}),("proxy"===t||"mysql"===t)&&l&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("input",{type:"text",className:I().inputProxyUrl,placeholder:"Proxy URL (e.g. http://localhost:4000)",value:s||"",onChange:e=>l(e.target.value)}),(0,a.jsxs)("div",{className:I().buttonTestRow,children:[(0,a.jsx)("button",{type:"button",className:I().buttonTest,onClick:p,disabled:!s||"loading"===i,children:"loading"===i?"Testing...":"Test Connection"}),i&&(0,a.jsx)("div",{className:I().testStatusBox+("success"===i?" "+I().testStatusSuccess:"error"===i?" "+I().testStatusError:""),children:c})]})]})]})]})};var M=r(3876),O=r.n(M);let P=(0,r(5028).default)(()=>Promise.all([r.e(776),r.e(699)]).then(r.bind(r,8699)),{loadableGenerated:{webpack:()=>[8699]},ssr:!1});function B(e,t,r,a){return{chart:{type:"heatmap"},dataLabels:{enabled:!1},xaxis:{categories:e.map(e=>e.toString()),title:{text:r}},yaxis:t.length>1?{title:{text:a}}:{show:!1},grid:{padding:{left:5,right:5,bottom:5,top:5}},colors:["#008FFB"],title:{text:"Plan Fingerprint Heatmap"}}}function D(e){let t=Array.from(e.keys()),r=t=>e.get(t),a=new Set,n=new Set;t.forEach(e=>{let[t,r]=e.split(",").map(Number);a.add(t),n.add(r)});let s=Array.from(a).sort((e,t)=>e-t),l=Array.from(n).sort((e,t)=>e-t),i=l.map(()=>s.map(()=>0));return t.forEach(e=>{var t;let[a,n]=e.split(",").map(Number),o=l.indexOf(n),c=s.indexOf(a);i[o][c]=null!=(t=r(e))?t:0}),i.map((e,t)=>({name:"".concat(l[t]),data:e}))}function Q(e){let t=new Map;return e.forEach((e,r)=>{let a=e.combinationKey||String(r),n=e.result;if(!n||"object"!=typeof n||!("rows"in n))return;let s=n.rows,l=Array.isArray(s)&&s.length>0?s[0]:void 0,i=l&&Object.values(l)[0];if(i){let e="string"==typeof i?JSON.parse(i):i;if(Array.isArray(e)&&e.length>0&&e[0].Plan){let r=e[0].Plan;"number"==typeof r["Plan Rows"]&&t.set(a,r["Plan Rows"])}}}),t}function H(e){let t=new Map;return e.forEach((e,r)=>{let a=e.combinationKey||String(r),n=e.result;if(!n||"object"!=typeof n||!("rows"in n))return;let s=n.rows,l=Array.isArray(s)&&s.length>0?s[0]:void 0,i=l&&Object.values(l)[0];if(i){let e="string"==typeof i?JSON.parse(i):i;if(Array.isArray(e)&&e.length>0&&e[0].Plan){let r=e[0].Plan;"number"==typeof r["Actual Rows"]&&t.set(a,r["Actual Rows"])}}}),t}let G=n.memo(e=>{let{open:t}=e;return(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:t?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"})});G.displayName="Arrow";let J=n.memo(e=>{let{dim0Name:t,dim1Name:r,planFingerprintByCombination:n}=e;if(!n||0===n.size)return null;let s=Array.from(n.keys()),l=new Set,i=new Set;s.forEach(e=>{let[t,r]=e.split(",").map(Number);i.add(t),l.add(r)});let o=Array.from(i).sort((e,t)=>e-t),c=Array.from(l),u=Math.max(0,c.length-10),p=D(n),d={...B(o,c,t,r),tooltip:{y:{formatter:e=>"Query plan: ".concat(e)}}};return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(P,{options:d,series:p,type:"heatmap",height:350+15*u})})});J.displayName="PlanHeatmap";let U=["#9400D3","#C71585","#008000","#00A100","#1E90FF","#128FD9","#00CFFF","#00FF00","#00FFFF","#FF00FF","#FF1493","#FF4500","#FF6F00","#FF0000","#FFB200","#FFD700"];function W(e,t){return Array.from({length:U.length},(r,a)=>{let n=e+a/U.length*(t-e),s=e+(a+1)/U.length*(t-e);return{from:n,to:s,color:U[a],name:"".concat(n.toFixed(0)," - ").concat(s.toFixed(0))}})}let X=n.memo(e=>{let{results:t,dim0Name:r,dim1Name:n}=e,s=function(e){let t=new Map;return e.forEach((e,r)=>{let a=e.combinationKey||String(r),n=e.result;if(!n||"object"!=typeof n||!("rows"in n))return;let s=n.rows,l=Array.isArray(s)&&s.length>0?s[0]:void 0,i=l&&Object.values(l)[0];if(i){let e="string"==typeof i?JSON.parse(i):i;if(Array.isArray(e)&&e.length>0&&e[0].Plan){let r=e[0].Plan;"number"==typeof r["Total Cost"]&&t.set(a,r["Total Cost"])}}}),t}(t);if(!s||0===s.size)return null;let l=Array.from(s.keys()),i=new Set,o=new Set;l.forEach(e=>{let[t,r]=e.split(",").map(Number);o.add(t),i.add(r)});let c=Array.from(o).sort((e,t)=>e-t),u=Array.from(i),p=Math.max(0,u.length-10),d=D(s),m=Array.from(s.values()),y=W(Math.min(...m),Math.max(...m)),h={...B(c,u,r,n),title:{text:"Total Cost Heatmap"},plotOptions:{heatmap:{colorScale:{ranges:y}}}};return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(P,{options:h,series:d,type:"heatmap",height:350+15*p})})});X.displayName="TotalCostHeatmap";let V=n.memo(e=>{let{results:t,dim0Name:r,dim1Name:n}=e,s=function(e){let t=new Map;return e.forEach((e,r)=>{let a=e.combinationKey||String(r),n=e.result;if(!n||"object"!=typeof n||!("rows"in n))return;let s=n.rows,l=Array.isArray(s)&&s.length>0?s[0]:void 0,i=l&&Object.values(l)[0];if(i){let e="string"==typeof i?JSON.parse(i):i;if(Array.isArray(e)&&e.length>0&&e[0].Plan){let r=e[0].Plan;"number"==typeof r["Actual Total Time"]&&t.set(a,r["Actual Total Time"])}}}),t}(t);if(!s||0===s.size)return null;let l=Array.from(s.keys()),i=new Set,o=new Set;l.forEach(e=>{let[t,r]=e.split(",").map(Number);o.add(t),i.add(r)});let c=Array.from(o).sort((e,t)=>e-t),u=Array.from(i),p=Math.max(0,u.length-10),d=D(s),m=Array.from(s.values()),y=W(Math.min(...m),Math.max(...m)),h={...B(c,u,r,n),title:{text:"Actual Total Time Heatmap"},plotOptions:{heatmap:{colorScale:{ranges:y}}}};return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(P,{options:h,series:d,type:"heatmap",height:350+15*p})})});V.displayName="ActualTotalTimeHeatmap";let z=n.memo(e=>{let{results:t,dim0Name:r,dim1Name:n}=e,s=Q(t);if(!s||0===s.size)return null;let l=Array.from(s.keys()),i=new Set,o=new Set;l.forEach(e=>{let[t,r]=e.split(",").map(Number);o.add(t),i.add(r)});let c=Array.from(o).sort((e,t)=>e-t),u=Array.from(i),p=Math.max(0,u.length-10),d=D(s),m=Array.from(s.values()),y=W(Math.min(...m),Math.max(...m)),h={...B(c,u,r,n),title:{text:"Expected Result Tuples"},plotOptions:{heatmap:{colorScale:{ranges:y}}}};return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(P,{options:h,series:d,type:"heatmap",height:350+15*p})})});z.displayName="PlanRowsHeatmap";let Z=n.memo(e=>{let{results:t,dim0Name:r,dim1Name:n}=e,s=H(t);if(!s||0===s.size)return null;let l=Array.from(s.keys()),i=new Set,o=new Set;l.forEach(e=>{let[t,r]=e.split(",").map(Number);o.add(t),i.add(r)});let c=Array.from(o).sort((e,t)=>e-t),u=Array.from(i),p=Math.max(0,u.length-10),d=D(s),m=Array.from(s.values()),y=W(Math.min(...m),Math.max(...m)),h={...B(c,u,r,n),title:{text:"Actual Tuples Heatmap"},plotOptions:{heatmap:{colorScale:{ranges:y}}}};return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(P,{options:h,series:d,type:"heatmap",height:350+15*p})})});Z.displayName="ActualTuplesHeatmap";let Y=n.memo(e=>{let{results:t,dim0Name:r,dim1Name:n}=e,s=H(t),l=Q(t);if(!s||!l||0===s.size||0===l.size)return null;let i=new Map;for(let[e,t]of s.entries()){let r=l.get(e);"number"==typeof r&&i.set(e,r-t)}if(0===i.size)return null;let o=Array.from(i.keys()),c=new Set,u=new Set;o.forEach(e=>{let[t,r]=e.split(",").map(Number);u.add(t),c.add(r)});let p=Array.from(u).sort((e,t)=>e-t),d=Array.from(c),m=Math.max(0,d.length-10),y=D(i),h=Array.from(i.values()),x=W(Math.min(...h),Math.max(...h)),f={...B(p,d,r,n),title:{text:"Actual - Planned Tuples Diff Heatmap"},plotOptions:{heatmap:{colorScale:{ranges:x}}}};return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(P,{options:f,series:y,type:"heatmap",height:350+15*m})})});Y.displayName="DiffTuplesHeatmap";let K=()=>y.size>0?(0,a.jsxs)("div",{className:O().planCount,children:["Number of different plans: ",y.size]}):null,$=e=>{let{planUsageCount:t}=e,[r,s]=(0,n.useState)({}),l=e=>{s(t=>({...t,[e]:!t[e]}))};return y.size>0?(0,a.jsxs)("div",{className:O().planFingerprintMapBox,children:[(0,a.jsx)("h3",{children:(0,a.jsx)("strong",{children:"Plan Fingerprints"})}),(0,a.jsx)("ul",{className:O().planFingerprintMapList,children:[...y.entries()].map(e=>{let[n,s]=e;return(0,a.jsxs)("li",{className:O().planFingerprintMapItem,children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>l(s),children:[(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:r[s]?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"}),(0,a.jsxs)("strong",{children:["Query plan ",s]}),(0,a.jsxs)("span",{className:O().planUsageCount,children:["(Used ",t[s]||0," times)"]})]}),(0,a.jsx)("pre",{className:O().planFingerprintMapPlan,children:n}),h.has(s)&&r[s]&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{marginTop:8,fontWeight:500},children:"Full Query Plan:"}),(0,a.jsx)("pre",{className:O().planFingerprintMapPlan,style:{whiteSpace:"pre-wrap",maxHeight:320,overflow:"auto"},children:h.get(s)})]})]},s)})})]}):null};$.displayName="PlanFingerprintMapList";let ee=e=>{let{title:t,results:r,boxClassName:s,preClassName:l,emptyText:i}=e,[o,c]=(0,n.useState)(!1);return(0,a.jsxs)("div",{className:s,children:[(0,a.jsxs)("div",{className:O().sectionTitle,style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center"},onClick:()=>c(e=>!e),children:[(0,a.jsx)(G,{open:o}),(0,a.jsx)("span",{style:{marginLeft:6},children:t})]}),o&&(0,a.jsx)("div",{className:O().resultContent,children:0===r.length?(0,a.jsx)("span",{className:O().noResult,children:null!=i?i:"No result"}):(0,a.jsx)("ul",{className:O().resultList,children:r.map((e,t)=>(0,a.jsx)("li",{className:O().resultItem,children:(0,a.jsxs)("pre",{className:l,style:{userSelect:"text"},children:[e.query,e.error?"\nError: ".concat(e.error):"\nResult: ".concat(JSON.stringify(e.result,null,2))]})},t))})})]})},et=()=>(0,a.jsx)("div",{className:O().noResult,style:{textAlign:"center"},children:"Please execute a query"});function er(e){let{results:t=[],dim0Name:r,dim1Name:n,isExecuting:s}=e,l={};f.forEach(e=>{l[e]=(l[e]||0)+1});let i=s||0===y.size;return(0,a.jsxs)("div",{className:O().resultBox,children:[!s&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(J,{dim0Name:r,dim1Name:n,planFingerprintByCombination:f}),(0,a.jsx)(K,{}),(0,a.jsx)($,{planUsageCount:l}),(0,a.jsx)(X,{results:t,dim0Name:r,dim1Name:n}),(0,a.jsx)(V,{results:t,dim0Name:r,dim1Name:n}),(0,a.jsx)(z,{results:t,dim0Name:r,dim1Name:n}),(0,a.jsx)(Z,{results:t,dim0Name:r,dim1Name:n}),(0,a.jsx)(Y,{results:t,dim0Name:r,dim1Name:n})]}),i&&(0,a.jsx)(et,{})]})}let ea=e=>{var t,r,n,s,l,i;let o=!e.isExecuting&&((null!=(n=null==(t=e.results)?void 0:t.length)?n:0)>0||(null!=(s=null==(r=e.preparationResults)?void 0:r.length)?s:0)>0);return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(er,{...e}),o&&(0,a.jsxs)("div",{className:O().detailsBox,children:[(0,a.jsx)("h3",{className:O().sectionTitle,style:{marginBottom:18},children:"Query Execution Details"}),(0,a.jsx)(ee,{title:"Detailed Preparation Steps",results:null!=(l=e.preparationResults)?l:[],boxClassName:O().preparationBox,preClassName:O().preparation,emptyText:"No preparation steps"}),(0,a.jsx)(ee,{title:"Detailed SQL Queries",results:null!=(i=e.results)?i:[],boxClassName:O().sqlBox,preClassName:O().sql,emptyText:"No result"})]})]})};var en=r(8334),es=r.n(en),el=r(5695),ei=r(1890),eo=r(9641).Buffer;function ec(){let[e,t]=(0,n.useState)(!1);(0,n.useEffect)(()=>{"1"===ei.env.NEXT_PUBLIC_DEVFULL&&t(!0)},[]);let[r,s]=(0,n.useState)("pglite"),[l,o]=(0,n.useState)(!1),[c,m]=(0,n.useState)(!1),[y,h]=(0,n.useState)(0),[x,f]=(0,n.useState)(5e4),[g,b]=(0,n.useState)(0),[S,N]=(0,n.useState)(10),[j,v]=(0,n.useState)([]),[E,A]=(0,n.useState)([]),[w,F]=(0,n.useState)(!0),[R,T]=(0,n.useState)(!0),[k,C]=(0,n.useState)(!0),[I,M]=(0,n.useState)(!0),[O,P]=(0,n.useState)(""),[B,D]=(0,n.useState)(1e3),[Q,H]=(0,n.useState)(1),[G,J]=(0,n.useState)(""),[U,W]=(0,n.useState)(!1),[X,V]=(0,n.useState)(void 0),[z,Z]=(0,n.useState)(null),Y="Dimension 0",K="Dimension 1",[$,ee]=(0,n.useState)(Y),[et,er]=(0,n.useState)(K),[en,ec]=(0,n.useState)("http://localhost:4000"),[eu,ep]=(0,n.useState)(null),ed=(0,el.useSearchParams)();async function em(){W(!0),Z(null),_(),V(void 0);let e=await L({dim1Active:c,start0:y,end0:x,step0:B,start1:g,end1:S,step1:Q,sqlQuery:O,preparation:G,backend:r,proxyUrl:en,onProgress:(e,t)=>Z({current:e,total:t}),executeQueries:l});A(e.preparationResults),v(e.sqlResults),V(e.error),W(!1),Z(null)}(0,n.useEffect)(()=>{let e=ed.get("share");if(e)try{let t=JSON.parse(eo.from(e,"base64").toString());"object"==typeof t&&t&&("number"==typeof t.start0&&h(t.start0),"number"==typeof t.end0&&f(t.end0),"number"==typeof t.step0&&D(t.step0),"number"==typeof t.start1&&b(t.start1),"number"==typeof t.end1&&N(t.end1),"number"==typeof t.step1&&H(t.step1),"boolean"==typeof t.dim1Active&&m(t.dim1Active),"string"==typeof t.preparationValue&&J(t.preparationValue),"string"==typeof t.sqlQuery&&P(t.sqlQuery),"string"==typeof t.description0&&ee(t.description0),"string"==typeof t.description1&&er(t.description1))}catch(e){}},[ed]);let ey=()=>{v([]),A([]),J(""),P(""),_(),m(!1),h(0),f(5e4),D(1e3),ee(Y),b(0),N(10),H(1),er(K),V(void 0)};return(0,a.jsxs)("div",{className:es().container,children:[(0,a.jsx)("h1",{className:es().heading,children:"Query Plan Explorer"}),e&&(0,a.jsx)(q,{value:r,onChange:function(e){s(e),"proxy"!==e&&o(!1)},proxyUrl:en,onProxyUrlChange:ec}),(0,a.jsx)(i,{label:"Dimension 0",start:y,end:x,setStart:h,setEnd:f,startValid:w,setStartValid:F,endValid:R,setEndValid:T,step:B,setStep:D,description:$,setDescription:ee}),c?(0,a.jsx)(i,{label:"Dimension 1",start:g,end:S,setStart:b,setEnd:N,startValid:k,setStartValid:C,endValid:I,setEndValid:M,step:Q,setStep:H,description:et,setDescription:er,onRemove:()=>m(!1)}):(0,a.jsx)("button",{onClick:()=>m(!0),className:es().buttonAdd,children:"+ Add Dimension 1"}),(0,a.jsx)("div",{style:{marginBottom:24},children:(0,a.jsx)(d,{value:O,onChange:P,dim1Active:c,preparationValue:G,onPreparationChange:J,executeQueries:l,onExecuteQueriesChange:o,showExperimentGroup:"proxy"===r})}),(0,a.jsxs)("div",{className:es().buttonRow,children:[(0,a.jsxs)("div",{className:es().demoButtonGroup,children:[(0,a.jsx)("button",{onClick:()=>{ey(),J(u),P(p),D(1e3),ee("WHERE key > X"),er(K)},className:es().buttonDemo,title:"Load Demo Query 1",children:"Query 1"}),(0,a.jsx)("button",{onClick:()=>{ey(),J(u),m(!0),b(0),N(8),H(.25),D(1e3),P("SET random_page_cost = %%DIMENSION1%%;\n"+p),ee("WHERE key > X"),er("random_page_cost")},className:es().buttonDemo,title:"Load Demo Query 2",children:"Query 2"}),(0,a.jsx)("button",{onClick:()=>{ey(),J(u),m(!0),b(0),N(8),H(.25),D(1e3),P("SET random_page_cost = %%DIMENSION1%%;\nSELECT * FROM data d1 LEFT JOIN data d2 ON (d1.key = d2.key) WHERE d1.key > %%DIMENSION0%%;"),ee("WHERE d1.key > X"),er("random_page_cost")},className:es().buttonDemo,title:"Load Demo Query 3",children:"Query 3"}),(0,a.jsx)("button",{onClick:()=>{ey(),J(u),m(!0),h(0),f(5e4),D(1e3),b(0),N(5e4),H(1e3),P("SELECT * FROM data d1 LEFT JOIN data d2 ON (d1.key = d2.key) WHERE d1.key > %%DIMENSION0%% AND d2.key > %%DIMENSION1%%;"),ee("d1.key > X"),er("d2.key > Y")},className:es().buttonDemo,title:"Load Demo Query 4",children:"Query 4"})]}),(0,a.jsxs)("div",{className:es().actionButtonGroup,children:[(0,a.jsx)("button",{onClick:em,className:es().buttonPrimary,disabled:U||!w||!R||c&&(!k||!I)||""===O.trim(),style:{minWidth:100},children:U?(0,a.jsx)("span",{className:es().spinner,"aria-label":"Loading"}):"Execute"}),(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",margin:"0 8px",position:"relative"},children:[(0,a.jsx)("button",{onClick:function(){let e=eo.from(JSON.stringify({start0:y,end0:x,step0:B,start1:g,end1:S,step1:Q,dim1Active:c,preparationValue:G,sqlQuery:O,description0:$,description1:et})).toString("base64"),t="".concat(window.location.origin).concat(window.location.pathname,"?share=").concat(encodeURIComponent(e));navigator.clipboard.writeText(t).then(()=>{ep("Link copied!"),setTimeout(()=>ep(null),2e3)},()=>{ep("Failed to copy"),setTimeout(()=>ep(null),2e3)})},className:es().buttonPrimary,type:"button",style:{minWidth:100},children:(0,a.jsx)("span",{style:{width:"100%",textAlign:"center"},children:"Share"})}),eu&&(0,a.jsx)("span",{className:es().shareNotification,children:eu})]}),(0,a.jsx)("button",{onClick:ey,className:es().buttonClear,style:{minWidth:100},children:"Clear"})]})]}),X&&(0,a.jsxs)("div",{style:{color:"#dc2626",background:"#fff0f0",border:"1.5px solid #ef4444",borderRadius:8,padding:"12px 18px",marginBottom:18,fontWeight:600},children:["Error: ",X]}),U&&z&&(0,a.jsxs)("div",{style:{margin:"1em 0"},children:[(0,a.jsx)("progress",{value:z.current,max:z.total,style:{width:"100%"}}),(0,a.jsxs)("div",{style:{textAlign:"center",fontSize:"0.9em"},children:["Query ",z.current," of ",z.total]})]}),(0,a.jsx)(ea,{results:j,preparationResults:E,dim0Name:$,dim1Name:et,isExecuting:U})]})}function eu(){return(0,a.jsx)(n.Suspense,{fallback:(0,a.jsx)("div",{children:"Loading..."}),children:(0,a.jsx)(ec,{})})}},3681:(e,t,r)=>{Promise.resolve().then(r.bind(r,2836))},3876:e=>{e.exports={resultBox:"ResultList_resultBox__7VdAH",resultTitle:"ResultList_resultTitle__pEBQd",resultContent:"ResultList_resultContent__e0zMT",resultList:"ResultList_resultList__l8npF",resultItem:"ResultList_resultItem__khMHP",sql:"ResultList_sql__LOTVk",noResult:"ResultList_noResult__Si0zi",noPreparationResult:"ResultList_noPreparationResult___C8rk",preparation:"ResultList_preparation__7rt90",planCount:"ResultList_planCount__Fm79l",collapseButton:"ResultList_collapseButton__aFGQg",planFingerprintMapBox:"ResultList_planFingerprintMapBox__787t6",planFingerprintMapList:"ResultList_planFingerprintMapList__T7Zm0",planFingerprintMapItem:"ResultList_planFingerprintMapItem__HPX0W",planFingerprintMapPlan:"ResultList_planFingerprintMapPlan__ZYZRO",planUsageCount:"ResultList_planUsageCount__h9DTM",preparationBox:"ResultList_preparationBox__W2mgd",sqlBox:"ResultList_sqlBox__NktaL",sectionTitle:"ResultList_sectionTitle__KgchB",detailsBox:"ResultList_detailsBox__tX4IK"}},6677:e=>{e.exports={intervalRow:"IntervalSelector_intervalRow__vhTVf",inputLabel:"IntervalSelector_inputLabel__Ju7_S",inputField:"IntervalSelector_inputField__ANvAB",inputFieldInvalid:"IntervalSelector_inputFieldInvalid__jtJTc",intervalInfo:"IntervalSelector_intervalInfo__JbWZa",dimensionGroup:"IntervalSelector_dimensionGroup__CGi_0",dimensionLegend:"IntervalSelector_dimensionLegend__Irkaf",removeButton:"IntervalSelector_removeButton__CQ_Go"}},8334:e=>{e.exports={container:"page_container__aoG4z",heading:"page_heading__ZPgh_",resultBox:"page_resultBox__evpxF",resultTitle:"page_resultTitle__nINtY",resultList:"page_resultList__ZBU6J",resultItem:"page_resultItem__jRIk2",buttonPrimary:"page_buttonPrimary__QtCGm",buttonAdd:"page_buttonAdd__2sSdl",buttonRemove:"page_buttonRemove__HiRAG",buttonClear:"page_buttonClear__KywYs",buttonReset:"page_buttonReset__fgRUt",buttonDemo:"page_buttonDemo__N_0nX",noResult:"page_noResult___U4Gg",spinner:"page_spinner__1WnEQ",spin:"page_spin__W_8_q",buttonRow:"page_buttonRow__iVZ1w",demoButtonGroup:"page_demoButtonGroup__BaAZG",actionButtonGroup:"page_actionButtonGroup__y6nC3",shareNotification:"page_shareNotification__18nbl"}}},e=>{var t=t=>e(e.s=t);e.O(0,[554,210,964,441,684,358],()=>t(3681)),_N_E=e.O()}]);