(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{131:e=>{e.exports={sqlBox:"SqlQueryInput_sqlBox__aXeGu",sqlLabel:"SqlQueryInput_sqlLabel__jEOgL",sqlTextarea:"SqlQueryInput_sqlTextarea__FNuM_",sqlHint:"SqlQueryInput_sqlHint__TQLcQ",sqlPlaceholderBtn:"SqlQueryInput_sqlPlaceholderBtn__iM5CO"}},1883:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>C});var a=n(5155),s=n(2115),l=n(6677),r=n.n(l);function i(e){let{label:t,start:n,end:l,setStart:i,setEnd:o,startValid:u,setStartValid:c,endValid:p,setEndValid:d,step:m,setStep:_,description:h,setDescription:x}=e,[g,N]=s.useState(n.toString()),[S,y]=s.useState(l.toString()),[f,j]=s.useState(m.toString()),[b,v]=s.useState(!0),[E,R]=s.useState(h);s.useEffect(()=>{N(n.toString())},[n]),s.useEffect(()=>{y(l.toString())},[l]),s.useEffect(()=>{j(m.toString())},[m]),s.useEffect(()=>{R(h)},[h]);let I=e=>""!==e&&"-"!==e&&/^-?\d+$/.test(e),F=e=>""!==e&&/^\d*\.?\d+$/.test(e)&&Number(e)>0,L=(e,t)=>!(I(e)&&I(t))||Number(t)>Number(e);return(0,a.jsxs)("div",{className:r().intervalRow,children:[(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsxs)("span",{children:[t," Start:"]}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:g,onChange:e=>{let t=e.target.value;N(t);let n=I(t);c(n),n&&I(S)&&d(I(S)&&L(t,S)),n&&i(Number(t))},className:u?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsx)("span",{children:"End:"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:S,onChange:e=>{let t=e.target.value;y(t);let n=I(t)&&L(g,t);d(n),I(g)&&c(I(g)),n&&o(Number(t))},className:p?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsx)("span",{children:"Step:"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:f,onChange:e=>{let t=e.target.value;j(t);let n=F(t);v(n),n&&_(Number(t))},className:b?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid),min:1})]}),(0,a.jsxs)("label",{className:r().inputLabel,style:{marginLeft:8},children:[(0,a.jsx)("span",{children:"Description:"}),(0,a.jsx)("input",{type:"text",value:E,onChange:e=>{let t=e.target.value;R(t),x(t)},className:r().inputField})]})]})}var o=n(131),u=n.n(o);let c="SET enable_seqscan = on;\nSET cpu_index_tuple_cost = 0.0005;\nCREATE TABLE data(key integer, value text);\nINSERT INTO data (key, value) SELECT i, i::text FROM generate_series(1, 100000) i;\nCREATE INDEX ON data(key);\nANALYZE data;",p="SELECT * FROM data WHERE key > %%DIMENSION0%%;";function d(e){let{value:t,onChange:n,dim1Active:l,preparationValue:r,onPreparationChange:i}=e,o=(0,s.useRef)(null),c=e=>{let a=o.current;if(!a)return;let s=a.selectionStart,l=a.selectionEnd;n(t.slice(0,s)+e+t.slice(l)),setTimeout(()=>{a.focus(),a.selectionStart=a.selectionEnd=s+e.length},0)};return(0,a.jsxs)("div",{className:u().sqlBox,children:[(0,a.jsx)("label",{htmlFor:"preparation-steps",className:u().sqlLabel,children:"Preparation Steps"}),(0,a.jsx)("textarea",{id:"preparation-steps",value:r,onChange:e=>i(e.target.value),rows:7,className:u().sqlTextarea,placeholder:"Describe any preparation steps here..."}),(0,a.jsx)("label",{htmlFor:"sql-query",className:u().sqlLabel,children:"SQL Query"}),(0,a.jsx)("textarea",{id:"sql-query",ref:o,value:t,onChange:e=>n(e.target.value),rows:3,className:u().sqlTextarea,placeholder:"Enter your SQL query here..."}),(0,a.jsxs)("div",{className:u().sqlHint,children:["You can use the placeholder"," ",(0,a.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>c("%%DIMENSION0%%"),children:"%%DIMENSION0%%"}),l&&(0,a.jsxs)(a.Fragment,{children:[" ","and"," ",(0,a.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>c("%%DIMENSION1%%"),children:"%%DIMENSION1%%"})]})," ","in your query."]})]})}var m=n(3876),_=n.n(m),h=n(5028),x=n(9967);let g=new Map,N=new Map,S=1;function y(){g.clear(),N.clear(),S=1}async function f(e){let t,{dim1Active:n,start0:a,end0:s,step0:l,start1:r,end1:i,step1:o,sqlQuery:u,preparation:c}=e,p=[],d=[],m={},_=e=>e.trim().toUpperCase().startsWith("SELECT"),h=e=>e.split(";").map(e=>e.trim()).filter(Boolean),y=new x.Eb;if(c)for(let e of h(c))try{let t=await y.query(e);p.push("".concat(e,";\nResult: ").concat(JSON.stringify(t,null,2)))}catch(n){t||(t="".concat(e,";\nError: ").concat(n)),p.push("".concat(e,";\nError: ").concat(n))}let f=async(e,n)=>{for(let a of h(e)){let e=a,s=!1;_(a)&&(e="EXPLAIN (FORMAT JSON) ".concat(a),s=!0);try{let t=await y.query(e);if(s)try{let e=t.rows,a=Array.isArray(e)&&e.length>0?e[0]:void 0,s=a&&Object.values(a)[0];s&&function(e,t){let n,a=function(e){let t=[];return Array.isArray(e)&&e.length>0&&e[0].Plan&&function e(t,n){if(!t||"object"!=typeof t)return;let a="string"==typeof t["Node Type"]?t["Node Type"]:void 0,s="string"==typeof t.Alias?t.Alias:void 0,l="string"==typeof t["Relation Name"]?t["Relation Name"]:void 0;if(a){let e=a;(s||l)&&(e+="(",s?e+=s:l&&(e+=l),e+=")"),n.push(e)}for(let a in t){let s=t[a];Array.isArray(s)?s.forEach(t=>e(t,n)):"object"==typeof s&&null!==s&&e(s,n)}}(e[0].Plan,t),t.join(">")}(e);g.has(a)?n=g.get(a):(n=S++,g.set(a,n),N.set(n,"string"==typeof e?e:JSON.stringify(e,null,2))),t&&(m[t]=n),window.console.log("Plan fingerprint:",a,"ID:",n)}(s,n)}catch(e){window.console.log("Explain JSON parse error:",e)}d.push("".concat(e,";\nResult: ").concat(JSON.stringify(t,null,2)))}catch(n){t||(t="".concat(e,";\nError: ").concat(n)),d.push("".concat(e,";\nError: ").concat(n))}}};if(n)for(let e=a;e<=s+1e-8;e+=l){let t=Number(e.toFixed(8));for(let e=r;e<=i+1e-8;e+=o){let n=Number(e.toFixed(8)),a=u.replaceAll("%%DIMENSION0%%",t.toString()).replaceAll("%%DIMENSION1%%",n.toString()),s="".concat(t,",").concat(n);await f(a,s)}}else for(let e=a;e<=s+1e-8;e+=l){let t=Number(e.toFixed(8)),n=u.replaceAll("%%DIMENSION0%%",t.toString()).replaceAll("%%DIMENSION1%%",""),a="".concat(t,",0");await f(n,a)}return{preparationResults:p,sqlResults:d,planFingerprintByCombination:m,error:t}}let j=(0,h.default)(()=>Promise.all([n.e(776),n.e(699)]).then(n.bind(n,8699)),{loadableGenerated:{webpack:()=>[8699]},ssr:!1}),b=s.memo(e=>{let{open:t}=e;return(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:t?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"})});b.displayName="Arrow";let v=e=>{let{planFingerprintByCombination:t,dim0Name:n,dim1Name:s}=e;if(!t||0===Object.keys(t).length)return null;let l=Object.keys(t),r=new Set;l.forEach(e=>{let[,t]=e.split(",").map(Number);r.add(t)});let i=Math.max(0,Array.from(r).length-10),{series:o,options:u}=function(e,t,n){let a=Object.keys(e),s=new Set,l=new Set;a.forEach(e=>{let[t,n]=e.split(",").map(Number);s.add(t),l.add(n)});let r=Array.from(s).sort((e,t)=>e-t),i=Array.from(l).sort((e,t)=>e-t),o=i.map(()=>r.map(()=>0));return a.forEach(t=>{let[n,a]=t.split(",").map(Number),s=i.indexOf(a),l=r.indexOf(n);o[s][l]=e[t]}),{series:o.map((e,t)=>({name:"".concat(i[t]),data:e})),options:{chart:{type:"heatmap"},dataLabels:{enabled:!1},xaxis:{categories:r.map(e=>e.toString()),title:{text:t}},yaxis:i.length>1?{title:{text:n}}:{show:!1},grid:{padding:{left:5,right:5,bottom:5,top:5}},colors:["#008FFB"],title:{text:"Plan Fingerprint Heatmap"}}}}(t,n,s);return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(j,{options:u,series:o,type:"heatmap",height:350+15*i})})};v.displayName="Heatmap";let E=e=>{let{planCount:t}=e;return void 0!==t&&g.size>0?(0,a.jsxs)("div",{className:_().planCount,children:["Number of different plans: ",t]}):null},R=e=>{let{planUsageCount:t}=e,[n,l]=(0,s.useState)({}),r=e=>{l(t=>({...t,[e]:!t[e]}))};return g.size>0?(0,a.jsxs)("div",{className:_().planFingerprintMapBox,children:[(0,a.jsx)("h3",{children:(0,a.jsx)("strong",{children:"Plan Fingerprints"})}),(0,a.jsx)("ul",{className:_().planFingerprintMapList,children:[...g.entries()].map(e=>{let[s,l]=e;return(0,a.jsxs)("li",{className:_().planFingerprintMapItem,children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>r(l),children:[(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:n[l]?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"}),(0,a.jsxs)("strong",{children:["Plan ",l]}),(0,a.jsxs)("span",{className:_().planUsageCount,children:["(Used ",t[l]||0," times)"]})]}),(0,a.jsx)("pre",{className:_().planFingerprintMapPlan,children:s}),N.has(l)&&n[l]&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{marginTop:8,fontWeight:500},children:"Full Query Plan:"}),(0,a.jsx)("pre",{className:_().planFingerprintMapPlan,style:{whiteSpace:"pre-wrap",maxHeight:320,overflow:"auto"},children:N.get(l)})]})]},l)})})]}):null};function I(e){let{results:t=[],preparationResults:n=[],planCount:l,planFingerprintByCombination:r,dim0Name:i,dim1Name:o}=e,[u,c]=(0,s.useState)(!1),[p,d]=(0,s.useState)(!1),m=t.length>0||n.length>0,h={};return Object.values(r).forEach(e=>{h[e]=(h[e]||0)+1}),(0,a.jsxs)("div",{className:_().resultBox,children:[(0,a.jsx)(v,{planFingerprintByCombination:r,dim0Name:i,dim1Name:o}),(0,a.jsx)(E,{planCount:l}),(0,a.jsx)(R,{planUsageCount:h}),m?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:0,marginTop:24},children:[(0,a.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center"},onClick:()=>c(e=>!e),children:[(0,a.jsx)(b,{open:u}),(0,a.jsx)("strong",{className:_().resultTitle,children:"Detailed Preparation Steps"})]}),u&&(0,a.jsx)("div",{className:_().resultContent,children:n.length>0?(0,a.jsx)("ul",{className:_().resultList,children:n.map((e,t)=>(0,a.jsx)("li",{className:_().resultItem,children:(0,a.jsx)("pre",{className:_().preparation,children:e})},t))}):(0,a.jsx)("span",{className:_().noPreparationResult,children:"No preparation steps"})}),(0,a.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",marginTop:8},onClick:()=>d(e=>!e),children:[(0,a.jsx)(b,{open:p}),(0,a.jsx)("strong",{className:_().resultTitle,children:"Detailed SQL Queries"})]}),p&&(0,a.jsx)("div",{className:_().resultContent,children:0===t.length?(0,a.jsx)("span",{className:_().noResult,children:"No result"}):(0,a.jsx)("ul",{className:_().resultList,children:t.map((e,t)=>(0,a.jsx)("li",{className:_().resultItem,children:(0,a.jsx)("span",{className:_().sql,children:e})},t))})})]}):(0,a.jsx)("div",{className:_().noResult,style:{textAlign:"center"},children:"Please execute a query"})]})}R.displayName="PlanFingerprintMapList";var F=n(8334),L=n.n(F);function C(){let[e,t]=(0,s.useState)(!1),[n,l]=(0,s.useState)(0),[r,o]=(0,s.useState)(5e4),[u,m]=(0,s.useState)(0),[_,h]=(0,s.useState)(10),[x,N]=(0,s.useState)([]),[S,j]=(0,s.useState)([]),[b,v]=(0,s.useState)(!0),[E,R]=(0,s.useState)(!0),[F,C]=(0,s.useState)(!0),[q,M]=(0,s.useState)(!0),[T,A]=(0,s.useState)(p),[P,O]=(0,s.useState)(2500),[w,k]=(0,s.useState)(1),[B,D]=(0,s.useState)(c),[Q,V]=(0,s.useState)(!1),[H,J]=(0,s.useState)(0),[U,W]=(0,s.useState)({}),[G,Z]=(0,s.useState)(void 0),z="Dimension 0",Y="Dimension 1",[X,$]=(0,s.useState)(z),[K,ee]=(0,s.useState)(Y);async function et(){V(!0),W({}),y(),Z(void 0);let t=await f({dim1Active:e,start0:n,end0:r,step0:P,start1:u,end1:_,step1:w,sqlQuery:T,preparation:B});j(t.preparationResults),N(t.sqlResults),J(g.size),W(t.planFingerprintByCombination),Z(t.error),V(!1)}return(0,a.jsxs)("div",{className:L().container,children:[(0,a.jsx)("h1",{className:L().heading,children:"Query Plan Explorer"}),(0,a.jsx)(i,{label:"Dimension 0",start:n,end:r,setStart:l,setEnd:o,startValid:b,setStartValid:v,endValid:E,setEndValid:R,step:P,setStep:O,description:X,setDescription:$}),e?(0,a.jsxs)("div",{children:[(0,a.jsx)(i,{label:"Dimension 1",start:u,end:_,setStart:m,setEnd:h,startValid:F,setStartValid:C,endValid:q,setEndValid:M,step:w,setStep:k,description:K,setDescription:ee}),(0,a.jsx)("button",{onClick:()=>t(!1),className:L().buttonRemove,children:"– Remove Dimension 1"})]}):(0,a.jsx)("button",{onClick:()=>t(!0),className:L().buttonAdd,children:"+ Add Dimension 1"}),(0,a.jsx)("div",{style:{marginBottom:24},children:(0,a.jsx)(d,{value:T,onChange:A,dim1Active:e,preparationValue:B,onPreparationChange:D})}),(0,a.jsxs)("div",{style:{display:"flex",gap:16,justifyContent:"center",marginBottom:16},children:[(0,a.jsx)("button",{onClick:et,className:L().buttonPrimary,disabled:Q||!b||!E||e&&(!F||!q)||""===T.trim(),children:Q?(0,a.jsx)("span",{className:L().spinner,"aria-label":"Loading"}):"Execute"}),(0,a.jsx)("button",{onClick:()=>{N([]),j([]),D(c),A(p),t(!1),W({}),y(),$(z),ee(Y),Z(void 0)},className:L().buttonReset,children:"Reset"}),(0,a.jsx)("button",{onClick:()=>{N([]),j([]),D(""),A(""),W({}),y(),$(z),ee(Y),Z(void 0)},className:L().buttonClear,children:"Clear"})]}),G&&(0,a.jsxs)("div",{style:{color:"#dc2626",background:"#fff0f0",border:"1.5px solid #ef4444",borderRadius:8,padding:"12px 18px",marginBottom:18,fontWeight:600},children:["Error: ",G]}),(0,a.jsx)(I,{results:x,preparationResults:S,planCount:H,planFingerprintByCombination:U,dim0Name:X,dim1Name:K})]})}},3681:(e,t,n)=>{Promise.resolve().then(n.bind(n,1883))},3876:e=>{e.exports={resultBox:"ResultList_resultBox__7VdAH",resultTitle:"ResultList_resultTitle__pEBQd",resultContent:"ResultList_resultContent__e0zMT",resultList:"ResultList_resultList__l8npF",resultItem:"ResultList_resultItem__khMHP",sql:"ResultList_sql__LOTVk",noResult:"ResultList_noResult__Si0zi",noPreparationResult:"ResultList_noPreparationResult___C8rk",preparation:"ResultList_preparation__7rt90",planCount:"ResultList_planCount__Fm79l",collapseButton:"ResultList_collapseButton__aFGQg",planFingerprintMapBox:"ResultList_planFingerprintMapBox__787t6",planFingerprintMapList:"ResultList_planFingerprintMapList__T7Zm0",planFingerprintMapItem:"ResultList_planFingerprintMapItem__HPX0W",planFingerprintMapPlan:"ResultList_planFingerprintMapPlan__ZYZRO",planUsageCount:"ResultList_planUsageCount__h9DTM"}},6677:e=>{e.exports={intervalRow:"IntervalSelector_intervalRow__vhTVf",inputLabel:"IntervalSelector_inputLabel__Ju7_S",inputField:"IntervalSelector_inputField__ANvAB",inputFieldInvalid:"IntervalSelector_inputFieldInvalid__jtJTc",intervalInfo:"IntervalSelector_intervalInfo__JbWZa"}},8334:e=>{e.exports={container:"page_container__aoG4z",heading:"page_heading__ZPgh_",resultBox:"page_resultBox__evpxF",resultTitle:"page_resultTitle__nINtY",resultList:"page_resultList__ZBU6J",resultItem:"page_resultItem__jRIk2",buttonPrimary:"page_buttonPrimary__QtCGm",buttonAdd:"page_buttonAdd__2sSdl",buttonRemove:"page_buttonRemove__HiRAG",buttonClear:"page_buttonClear__KywYs",buttonReset:"page_buttonReset__fgRUt",noResult:"page_noResult___U4Gg",spinner:"page_spinner__1WnEQ",spin:"page_spin__W_8_q"}}},e=>{var t=t=>e(e.s=t);e.O(0,[991,210,774,441,684,358],()=>t(3681)),_N_E=e.O()}]);