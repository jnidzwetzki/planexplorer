(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{131:e=>{e.exports={sqlBox:"SqlQueryInput_sqlBox__aXeGu",sqlLabel:"SqlQueryInput_sqlLabel__jEOgL",sqlTextarea:"SqlQueryInput_sqlTextarea__FNuM_",sqlHint:"SqlQueryInput_sqlHint__TQLcQ",sqlPlaceholderBtn:"SqlQueryInput_sqlPlaceholderBtn__iM5CO"}},1883:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>L});var a=n(5155),l=n(2115),s=n(6677),r=n.n(s);function i(e){let{label:t,start:n,end:s,setStart:i,setEnd:o,startValid:u,setStartValid:p,endValid:c,setEndValid:d,step:m,setStep:h,description:_,setDescription:g}=e,[x,N]=l.useState(n.toString()),[y,S]=l.useState(s.toString()),[f,j]=l.useState(m.toString()),[b,v]=l.useState(!0),[E,R]=l.useState(_);l.useEffect(()=>{N(n.toString())},[n]),l.useEffect(()=>{S(s.toString())},[s]),l.useEffect(()=>{j(m.toString())},[m]),l.useEffect(()=>{R(_)},[_]);let C=e=>""!==e&&"-"!==e&&/^-?\d+$/.test(e),F=e=>""!==e&&/^\d*\.?\d+$/.test(e)&&Number(e)>0,I=(e,t)=>!(C(e)&&C(t))||Number(t)>Number(e);return(0,a.jsxs)("div",{className:r().intervalRow,children:[(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsxs)("span",{children:[t," Start:"]}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:x,onChange:e=>{let t=e.target.value;N(t);let n=C(t);p(n),n&&C(y)&&d(C(y)&&I(t,y)),n&&i(Number(t))},className:u?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsx)("span",{children:"End:"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:y,onChange:e=>{let t=e.target.value;S(t);let n=C(t)&&I(x,t);d(n),C(x)&&p(C(x)),n&&o(Number(t))},className:c?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsx)("span",{children:"Step:"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:f,onChange:e=>{let t=e.target.value;j(t);let n=F(t);v(n),n&&h(Number(t))},className:b?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid),min:1})]}),(0,a.jsxs)("label",{className:r().inputLabel,style:{marginLeft:8},children:[(0,a.jsx)("span",{children:"Description:"}),(0,a.jsx)("input",{type:"text",value:E,onChange:e=>{let t=e.target.value;R(t),g(t)},className:r().inputField})]})]})}var o=n(131),u=n.n(o);let p="SET enable_seqscan = on;\nSET cpu_index_tuple_cost = 0.0005;\nCREATE TABLE data(key integer, value text);\nINSERT INTO data (key, value) SELECT i, i::text FROM generate_series(1, 100000) i;\nCREATE INDEX ON data(key);\nANALYZE data;",c="SELECT * FROM data WHERE key > %%DIMENSION0%%;";function d(e){let{value:t,onChange:n,dim1Active:s,preparationValue:r,onPreparationChange:i}=e,o=(0,l.useRef)(null),p=e=>{let a=o.current;if(!a)return;let l=a.selectionStart,s=a.selectionEnd;n(t.slice(0,l)+e+t.slice(s)),setTimeout(()=>{a.focus(),a.selectionStart=a.selectionEnd=l+e.length},0)};return(0,a.jsxs)("div",{className:u().sqlBox,children:[(0,a.jsx)("label",{htmlFor:"preparation-steps",className:u().sqlLabel,children:"Preparation Steps"}),(0,a.jsx)("textarea",{id:"preparation-steps",value:r,onChange:e=>i(e.target.value),rows:7,className:u().sqlTextarea,placeholder:"Describe any preparation steps here..."}),(0,a.jsx)("label",{htmlFor:"sql-query",className:u().sqlLabel,children:"SQL Query"}),(0,a.jsx)("textarea",{id:"sql-query",ref:o,value:t,onChange:e=>n(e.target.value),rows:3,className:u().sqlTextarea,placeholder:"Enter your SQL query here..."}),(0,a.jsxs)("div",{className:u().sqlHint,children:["You can use the placeholder"," ",(0,a.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>p("%%DIMENSION0%%"),children:"%%DIMENSION0%%"}),s&&(0,a.jsxs)(a.Fragment,{children:[" ","and"," ",(0,a.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>p("%%DIMENSION1%%"),children:"%%DIMENSION1%%"})]})," ","in your query."]})]})}var m=n(3876),h=n.n(m),_=n(5028),g=n(9967);let x=new Map,N=new Map,y=1;function S(){x.clear(),N.clear(),y=1}async function f(e){let t,n,{dim1Active:a,start0:l,end0:s,step0:r,start1:i,end1:o,step1:u,sqlQuery:p,preparation:c}=e,d=[],m=[],h={},_=e=>e.trim().toUpperCase().startsWith("SELECT"),S=e=>e.split(";").map(e=>e.trim()).filter(Boolean),f=new g.Eb;if(c)for(let e of S(c))try{let t=await f.query(e);d.push("".concat(e,";\nResult: ").concat(JSON.stringify(t,null,2)))}catch(n){t||(t="".concat(e,";\nError: ").concat(n)),d.push("".concat(e,";\nError: ").concat(n))}let j=0;if(a)for(let e=l;e<=s+1e-8;e+=r)for(let e=i;e<=o+1e-8;e+=u)j++;else for(let e=l;e<=s+1e-8;e+=r)j++;let b=!1,v=0;if(j>100){n=new Set;for(let e=0;e<100;e++)n.add(Math.floor(e*j/100));b=!0,v=100}else v=j;let E=0,R=async(e,a)=>{for(let l of S(e)){let e=l,s=!1;_(l)&&(e="EXPLAIN (FORMAT JSON) ".concat(l),s=!0);try{let t=await f.query(e);if(s)try{let e=t.rows,n=Array.isArray(e)&&e.length>0?e[0]:void 0,l=n&&Object.values(n)[0];l&&function(e,t,n){var a;let l,s=(a=function(e){let t=[];return Array.isArray(e)&&e.length>0&&e[0].Plan&&function e(t,n){if(!t||"object"!=typeof t)return;let a="string"==typeof t["Node Type"]?t["Node Type"]:void 0,l="string"==typeof t.Alias?t.Alias:void 0,s="string"==typeof t["Relation Name"]?t["Relation Name"]:void 0;if(a){let e=a;(l||s)&&(e+="(",l?e+=l:s&&(e+=s),e+=")"),n.push(e)}for(let a in t){let l=t[a];Array.isArray(l)?l.forEach(t=>e(t,n)):"object"==typeof l&&null!==l&&e(l,n)}}(e[0].Plan,t),t.join(">")}(e),x.has(a)?l=x.get(a):(l=y++,x.set(a,l),N.set(l,"string"==typeof e?e:JSON.stringify(e,null,2))),l);t&&(n[t]=s)}(l,a,h)}catch(e){window.console.log("Explain JSON parse error:",e)}(!n||n.has(E))&&m.push("".concat(e,";\nResult: ").concat(JSON.stringify(t,null,2)))}catch(a){t||(t="".concat(e,";\nError: ").concat(a)),(!n||n.has(E))&&m.push("".concat(e,";\nError: ").concat(a))}}E++};if(a)for(let e=l;e<=s+1e-8;e+=r){let t=Number(e.toFixed(8));for(let e=i;e<=o+1e-8;e+=u){let n=Number(e.toFixed(8)),a=p.replaceAll("%%DIMENSION0%%",t.toString()).replaceAll("%%DIMENSION1%%",n.toString()),l="".concat(t,",").concat(n);await R(a,l)}}else for(let e=l;e<=s+1e-8;e+=r){let t=Number(e.toFixed(8)),n=p.replaceAll("%%DIMENSION0%%",t.toString()).replaceAll("%%DIMENSION1%%",""),a="".concat(t,",0");await R(n,a)}return{preparationResults:d,sqlResults:m,planFingerprintByCombination:h,error:t,sampled:b,sampleCount:v,totalExecutions:j}}let j=(0,_.default)(()=>Promise.all([n.e(776),n.e(699)]).then(n.bind(n,8699)),{loadableGenerated:{webpack:()=>[8699]},ssr:!1}),b=l.memo(e=>{let{open:t}=e;return(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:t?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"})});b.displayName="Arrow";let v=l.memo(e=>{let{planFingerprintByCombination:t,dim0Name:n,dim1Name:l}=e;if(!t||0===Object.keys(t).length)return null;let s=Object.keys(t),r=new Set;s.forEach(e=>{let[,t]=e.split(",").map(Number);r.add(t)});let i=Math.max(0,Array.from(r).length-10),{series:o,options:u}=function(e,t,n){let a=Object.keys(e),l=new Set,s=new Set;a.forEach(e=>{let[t,n]=e.split(",").map(Number);l.add(t),s.add(n)});let r=Array.from(l).sort((e,t)=>e-t),i=Array.from(s).sort((e,t)=>e-t),o=i.map(()=>r.map(()=>0));return a.forEach(t=>{let[n,a]=t.split(",").map(Number),l=i.indexOf(a),s=r.indexOf(n);o[l][s]=e[t]}),{series:o.map((e,t)=>({name:"".concat(i[t]),data:e})),options:{chart:{type:"heatmap"},dataLabels:{enabled:!1},xaxis:{categories:r.map(e=>e.toString()),title:{text:t}},yaxis:i.length>1?{title:{text:n}}:{show:!1},grid:{padding:{left:5,right:5,bottom:5,top:5}},colors:["#008FFB"],title:{text:"Plan Fingerprint Heatmap"}}}}(t,n,l);return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(j,{options:u,series:o,type:"heatmap",height:350+15*i})})},(e,t)=>e.dim0Name===t.dim0Name&&e.dim1Name===t.dim1Name&&Object.keys(e.planFingerprintByCombination).length===Object.keys(t.planFingerprintByCombination).length&&Object.entries(e.planFingerprintByCombination).every(e=>{let[n,a]=e;return t.planFingerprintByCombination[n]===a}));v.displayName="Heatmap";let E=e=>{let{planCount:t}=e;return void 0!==t&&x.size>0?(0,a.jsxs)("div",{className:h().planCount,children:["Number of different plans: ",t]}):null},R=e=>{let{planUsageCount:t}=e,[n,s]=(0,l.useState)({}),r=e=>{s(t=>({...t,[e]:!t[e]}))};return x.size>0?(0,a.jsxs)("div",{className:h().planFingerprintMapBox,children:[(0,a.jsx)("h3",{children:(0,a.jsx)("strong",{children:"Plan Fingerprints"})}),(0,a.jsx)("ul",{className:h().planFingerprintMapList,children:[...x.entries()].map(e=>{let[l,s]=e;return(0,a.jsxs)("li",{className:h().planFingerprintMapItem,children:[(0,a.jsxs)("div",{style:{display:"flex",alignItems:"center",cursor:"pointer"},onClick:()=>r(s),children:[(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:n[s]?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"}),(0,a.jsxs)("strong",{children:["Plan ",s]}),(0,a.jsxs)("span",{className:h().planUsageCount,children:["(Used ",t[s]||0," times)"]})]}),(0,a.jsx)("pre",{className:h().planFingerprintMapPlan,children:l}),N.has(s)&&n[s]&&(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("div",{style:{marginTop:8,fontWeight:500},children:"Full Query Plan:"}),(0,a.jsx)("pre",{className:h().planFingerprintMapPlan,style:{whiteSpace:"pre-wrap",maxHeight:320,overflow:"auto"},children:N.get(s)})]})]},s)})})]}):null};function C(e){let{results:t=[],preparationResults:n=[],planCount:s,planFingerprintByCombination:r,dim0Name:i,dim1Name:o,sampled:u,sampleCount:p,totalExecutions:c}=e,[d,m]=(0,l.useState)(!1),[_,g]=(0,l.useState)(!1),x=t.length>0||n.length>0,N={};return Object.values(r).forEach(e=>{N[e]=(N[e]||0)+1}),(0,a.jsxs)("div",{className:h().resultBox,children:[(0,a.jsx)(v,{planFingerprintByCombination:r,dim0Name:i,dim1Name:o}),(0,a.jsx)(E,{planCount:s}),(0,a.jsx)(R,{planUsageCount:N}),x?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:0,marginTop:24},children:[(0,a.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center"},onClick:()=>m(e=>!e),children:[(0,a.jsx)(b,{open:d}),(0,a.jsx)("strong",{className:h().resultTitle,children:"Detailed Preparation Steps"})]}),d&&(0,a.jsx)("div",{className:h().resultContent,children:n.length>0?(0,a.jsx)("ul",{className:h().resultList,children:n.map((e,t)=>(0,a.jsx)("li",{className:h().resultItem,children:(0,a.jsx)("pre",{className:h().preparation,children:e})},t))}):(0,a.jsx)("span",{className:h().noPreparationResult,children:"No preparation steps"})}),(0,a.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",marginTop:8},onClick:()=>g(e=>!e),children:[(0,a.jsx)(b,{open:_}),(0,a.jsx)("strong",{className:h().resultTitle,children:"Detailed SQL Queries"}),u&&(0,a.jsxs)("span",{className:h().planUsageCount,children:["(Sampled ",p," of ",c,")"]})]}),_&&(0,a.jsx)("div",{className:h().resultContent,children:0===t.length?(0,a.jsx)("span",{className:h().noResult,children:"No result"}):(0,a.jsx)("ul",{className:h().resultList,children:t.map((e,t)=>(0,a.jsx)("li",{className:h().resultItem,children:(0,a.jsx)("span",{className:h().sql,children:e})},t))})})]}):(0,a.jsx)("div",{className:h().noResult,style:{textAlign:"center"},children:"Please execute a query"})]})}R.displayName="PlanFingerprintMapList";var F=n(8334),I=n.n(F);function L(){let[e,t]=(0,l.useState)(!1),[n,s]=(0,l.useState)(0),[r,o]=(0,l.useState)(5e4),[u,m]=(0,l.useState)(0),[h,_]=(0,l.useState)(10),[g,N]=(0,l.useState)([]),[y,j]=(0,l.useState)([]),[b,v]=(0,l.useState)(!0),[E,R]=(0,l.useState)(!0),[F,L]=(0,l.useState)(!0),[q,M]=(0,l.useState)(!0),[O,T]=(0,l.useState)(c),[A,B]=(0,l.useState)(2500),[P,k]=(0,l.useState)(1),[w,D]=(0,l.useState)(p),[Q,V]=(0,l.useState)(!1),[H,U]=(0,l.useState)(0),[J,W]=(0,l.useState)({}),[G,Z]=(0,l.useState)(void 0),z="Dimension 0",Y="Dimension 1",[X,$]=(0,l.useState)(z),[K,ee]=(0,l.useState)(Y),[et,en]=(0,l.useState)(!1),[ea,el]=(0,l.useState)(void 0),[es,er]=(0,l.useState)(void 0);async function ei(){var t;V(!0),W({}),S(),Z(void 0);let a=await f({dim1Active:e,start0:n,end0:r,step0:A,start1:u,end1:h,step1:P,sqlQuery:O,preparation:w});j(a.preparationResults),N(a.sqlResults),U(x.size),W(a.planFingerprintByCombination),Z(a.error),en(null!=(t=a.sampled)&&t),el(a.sampleCount),er(a.totalExecutions),V(!1)}return(0,a.jsxs)("div",{className:I().container,children:[(0,a.jsx)("h1",{className:I().heading,children:"Query Plan Explorer"}),(0,a.jsx)(i,{label:"Dimension 0",start:n,end:r,setStart:s,setEnd:o,startValid:b,setStartValid:v,endValid:E,setEndValid:R,step:A,setStep:B,description:X,setDescription:$}),e?(0,a.jsxs)("div",{children:[(0,a.jsx)(i,{label:"Dimension 1",start:u,end:h,setStart:m,setEnd:_,startValid:F,setStartValid:L,endValid:q,setEndValid:M,step:P,setStep:k,description:K,setDescription:ee}),(0,a.jsx)("button",{onClick:()=>t(!1),className:I().buttonRemove,children:"– Remove Dimension 1"})]}):(0,a.jsx)("button",{onClick:()=>t(!0),className:I().buttonAdd,children:"+ Add Dimension 1"}),(0,a.jsx)("div",{style:{marginBottom:24},children:(0,a.jsx)(d,{value:O,onChange:T,dim1Active:e,preparationValue:w,onPreparationChange:D})}),(0,a.jsxs)("div",{style:{display:"flex",gap:16,justifyContent:"center",marginBottom:16},children:[(0,a.jsx)("button",{onClick:ei,className:I().buttonPrimary,disabled:Q||!b||!E||e&&(!F||!q)||""===O.trim(),children:Q?(0,a.jsx)("span",{className:I().spinner,"aria-label":"Loading"}):"Execute"}),(0,a.jsx)("button",{onClick:()=>{N([]),j([]),D(p),T(c),t(!1),W({}),S(),$(z),ee(Y),Z(void 0)},className:I().buttonReset,children:"Reset"}),(0,a.jsx)("button",{onClick:()=>{N([]),j([]),D(""),T(""),W({}),S(),$(z),ee(Y),Z(void 0)},className:I().buttonClear,children:"Clear"})]}),G&&(0,a.jsxs)("div",{style:{color:"#dc2626",background:"#fff0f0",border:"1.5px solid #ef4444",borderRadius:8,padding:"12px 18px",marginBottom:18,fontWeight:600},children:["Error: ",G]}),(0,a.jsx)(C,{results:g,preparationResults:y,planCount:H,planFingerprintByCombination:J,dim0Name:X,dim1Name:K,sampled:et,sampleCount:ea,totalExecutions:es})]})}},3681:(e,t,n)=>{Promise.resolve().then(n.bind(n,1883))},3876:e=>{e.exports={resultBox:"ResultList_resultBox__7VdAH",resultTitle:"ResultList_resultTitle__pEBQd",resultContent:"ResultList_resultContent__e0zMT",resultList:"ResultList_resultList__l8npF",resultItem:"ResultList_resultItem__khMHP",sql:"ResultList_sql__LOTVk",noResult:"ResultList_noResult__Si0zi",noPreparationResult:"ResultList_noPreparationResult___C8rk",preparation:"ResultList_preparation__7rt90",planCount:"ResultList_planCount__Fm79l",collapseButton:"ResultList_collapseButton__aFGQg",planFingerprintMapBox:"ResultList_planFingerprintMapBox__787t6",planFingerprintMapList:"ResultList_planFingerprintMapList__T7Zm0",planFingerprintMapItem:"ResultList_planFingerprintMapItem__HPX0W",planFingerprintMapPlan:"ResultList_planFingerprintMapPlan__ZYZRO",planUsageCount:"ResultList_planUsageCount__h9DTM"}},6677:e=>{e.exports={intervalRow:"IntervalSelector_intervalRow__vhTVf",inputLabel:"IntervalSelector_inputLabel__Ju7_S",inputField:"IntervalSelector_inputField__ANvAB",inputFieldInvalid:"IntervalSelector_inputFieldInvalid__jtJTc",intervalInfo:"IntervalSelector_intervalInfo__JbWZa"}},8334:e=>{e.exports={container:"page_container__aoG4z",heading:"page_heading__ZPgh_",resultBox:"page_resultBox__evpxF",resultTitle:"page_resultTitle__nINtY",resultList:"page_resultList__ZBU6J",resultItem:"page_resultItem__jRIk2",buttonPrimary:"page_buttonPrimary__QtCGm",buttonAdd:"page_buttonAdd__2sSdl",buttonRemove:"page_buttonRemove__HiRAG",buttonClear:"page_buttonClear__KywYs",buttonReset:"page_buttonReset__fgRUt",noResult:"page_noResult___U4Gg",spinner:"page_spinner__1WnEQ",spin:"page_spin__W_8_q"}}},e=>{var t=t=>e(e.s=t);e.O(0,[991,210,774,441,684,358],()=>t(3681)),_N_E=e.O()}]);