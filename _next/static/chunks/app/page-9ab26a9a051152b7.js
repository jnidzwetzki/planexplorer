(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{131:e=>{e.exports={sqlBox:"SqlQueryInput_sqlBox__aXeGu",sqlLabel:"SqlQueryInput_sqlLabel__jEOgL",sqlTextarea:"SqlQueryInput_sqlTextarea__FNuM_",sqlHint:"SqlQueryInput_sqlHint__TQLcQ",sqlPlaceholderBtn:"SqlQueryInput_sqlPlaceholderBtn__iM5CO"}},1883:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var l=n(5155),a=n(2115),s=n(6677),r=n.n(s);function i(e){let{label:t,start:n,end:s,setStart:i,setEnd:o,startValid:u,setStartValid:c,endValid:p,setEndValid:d,step:_,setStep:m}=e,[x,h]=a.useState(n.toString()),[g,N]=a.useState(s.toString()),[S,y]=a.useState(_.toString()),[j,b]=a.useState(!0);a.useEffect(()=>{h(n.toString())},[n]),a.useEffect(()=>{N(s.toString())},[s]),a.useEffect(()=>{y(_.toString())},[_]);let f=e=>""!==e&&"-"!==e&&/^-?\d+$/.test(e),v=e=>""!==e&&/^\d*\.?\d+$/.test(e)&&Number(e)>0,E=(e,t)=>!(f(e)&&f(t))||Number(t)>Number(e);return(0,l.jsxs)("div",{className:r().intervalRow,children:[(0,l.jsxs)("label",{className:r().inputLabel,children:[(0,l.jsxs)("span",{children:[t," Start:"]}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",value:x,onChange:e=>{let t=e.target.value;h(t);let n=f(t);c(n),n&&f(g)&&d(f(g)&&E(t,g)),n&&i(Number(t))},className:u?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,l.jsxs)("label",{className:r().inputLabel,children:[(0,l.jsx)("span",{children:"End:"}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",value:g,onChange:e=>{let t=e.target.value;N(t);let n=f(t)&&E(x,t);d(n),f(x)&&c(f(x)),n&&o(Number(t))},className:p?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,l.jsxs)("label",{className:r().inputLabel,children:[(0,l.jsx)("span",{children:"Step:"}),(0,l.jsx)("input",{type:"text",inputMode:"numeric",value:S,onChange:e=>{let t=e.target.value;y(t);let n=v(t);b(n),n&&m(Number(t))},className:j?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid),min:1})]})]})}var o=n(131),u=n.n(o);let c="SET enable_seqscan = on;\nSET cpu_index_tuple_cost = 0.0005;\nCREATE TABLE data(key integer, value text);\nINSERT INTO data (key, value) SELECT i, i::text FROM generate_series(1, 100000) i;\nCREATE INDEX ON data(key);\nANALYZE data;",p="SELECT * FROM data WHERE key > %%DIMENSION0%%;";function d(e){let{value:t,onChange:n,dim1Active:s,preparationValue:r,onPreparationChange:i}=e,o=(0,a.useRef)(null),c=e=>{let l=o.current;if(!l)return;let a=l.selectionStart,s=l.selectionEnd;n(t.slice(0,a)+e+t.slice(s)),setTimeout(()=>{l.focus(),l.selectionStart=l.selectionEnd=a+e.length},0)};return(0,l.jsxs)("div",{className:u().sqlBox,children:[(0,l.jsx)("label",{htmlFor:"preparation-steps",className:u().sqlLabel,children:"Preparation Steps"}),(0,l.jsx)("textarea",{id:"preparation-steps",value:r,onChange:e=>i(e.target.value),rows:7,className:u().sqlTextarea,placeholder:"Describe any preparation steps here..."}),(0,l.jsx)("label",{htmlFor:"sql-query",className:u().sqlLabel,children:"SQL Query"}),(0,l.jsx)("textarea",{id:"sql-query",ref:o,value:t,onChange:e=>n(e.target.value),rows:3,className:u().sqlTextarea,placeholder:"Enter your SQL query here..."}),(0,l.jsxs)("div",{className:u().sqlHint,children:["You can use the placeholder"," ",(0,l.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>c("%%DIMENSION0%%"),children:"%%DIMENSION0%%"}),s&&(0,l.jsxs)(l.Fragment,{children:[" ","and"," ",(0,l.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>c("%%DIMENSION1%%"),children:"%%DIMENSION1%%"})]})," ","in your query."]})]})}var _=n(3876),m=n.n(_),x=n(5028),h=n(9967);let g=new Map,N=1;function S(e,t){if(e&&"object"==typeof e)for(let n in"string"==typeof e["Node Type"]&&t.push(e["Node Type"]),e){let l=e[n];Array.isArray(l)?l.forEach(e=>S(e,t)):"object"==typeof l&&null!==l&&S(l,t)}}function y(){g.clear(),N=1}async function j(e){let{dim1Active:t,start0:n,end0:l,step0:a,start1:s,end1:r,step1:i,sqlQuery:o,preparation:u}=e,c=[],p=[],d={},_=e=>e.trim().toUpperCase().startsWith("SELECT"),m=e=>e.split(";").map(e=>e.trim()).filter(Boolean),x=new h.Eb;if(u)for(let e of m(u))try{let t=await x.query(e);c.push("".concat(e,";\nResult: ").concat(JSON.stringify(t,null,2)))}catch(t){c.push("".concat(e,";\nError: ").concat(t))}let y=async(e,t)=>{for(let n of m(e)){let e=n,l=!1;_(n)&&(e="EXPLAIN (FORMAT JSON) ".concat(n),l=!0);try{let n=await x.query(e);if(l)try{let e=n.rows,l=Array.isArray(e)&&e.length>0?e[0]:void 0,a=l&&Object.values(l)[0];a&&function(e,t){let n,l=function(e){let t=[];return Array.isArray(e)&&e.length>0&&e[0].Plan?S(e[0].Plan,t):Array.isArray(e)&&e.length>0&&e[0].Plan&&S(e[0].Plan,t),t.join(">")}(e);g.has(l)?n=g.get(l):(n=N++,g.set(l,n)),t&&(d[t]=n),window.console.log("Plan fingerprint:",l,"ID:",n)}(a,t)}catch(e){window.console.log("Explain JSON parse error:",e)}p.push("".concat(e,";\nResult: ").concat(JSON.stringify(n,null,2)))}catch(t){p.push("".concat(e,";\nError: ").concat(t))}}};if(t)for(let e=n;e<=l;e+=a)for(let t=s;t<=r;t+=i){let n=o.replaceAll("%%DIMENSION0%%",e.toString()).replaceAll("%%DIMENSION1%%",t.toString()),l="".concat(e,",").concat(t);await y(n,l)}else for(let e=n;e<=l;e+=a){let t=o.replaceAll("%%DIMENSION0%%",e.toString()).replaceAll("%%DIMENSION1%%",""),n="".concat(e,",0");await y(t,n)}return{preparationResults:c,sqlResults:p,planFingerprintByCombination:d}}let b=(0,x.default)(()=>Promise.all([n.e(776),n.e(699)]).then(n.bind(n,8699)),{loadableGenerated:{webpack:()=>[8699]},ssr:!1}),f=a.memo(e=>{let{open:t}=e;return(0,l.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:t?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"})});f.displayName="Arrow";let v=e=>{let{planFingerprintByCombination:t}=e;if(!t||0===Object.keys(t).length)return null;let{series:n,options:a}=function(e){let t=Object.keys(e),n=new Set,l=new Set;t.forEach(e=>{let[t,a]=e.split(",").map(Number);n.add(t),l.add(a)});let a=Array.from(n).sort((e,t)=>e-t),s=Array.from(l).sort((e,t)=>e-t),r=s.map(()=>a.map(()=>0));return t.forEach(t=>{let[n,l]=t.split(",").map(Number),i=s.indexOf(l),o=a.indexOf(n);r[i][o]=e[t]}),{series:r.map((e,t)=>({name:"Y=".concat(s[t]),data:e})),options:{chart:{type:"heatmap"},dataLabels:{enabled:!1},xaxis:{categories:a.map(e=>e.toString()),title:{text:"Dimension 0"}},yaxis:{title:{text:"Dimension 1"}},colors:["#008FFB"],title:{text:"Plan Fingerprint Heatmap"}}}}(t);return(0,l.jsx)("div",{style:{margin:"24px 0"},children:(0,l.jsx)(b,{options:a,series:n,type:"heatmap",height:350})})};v.displayName="Heatmap";let E=e=>{let{planCount:t}=e;return void 0!==t&&g.size>0?(0,l.jsxs)("div",{className:m().planCount,children:["Number of different plans: ",t]}):null},I=()=>g.size>0?(0,l.jsxs)("div",{className:m().planFingerprintMapBox,children:[(0,l.jsx)("h3",{children:(0,l.jsx)("strong",{children:"Plan Fingerprint Map"})}),(0,l.jsx)("ul",{className:m().planFingerprintMapList,children:[...g.entries()].map(e=>{let[t,n]=e;return(0,l.jsxs)("li",{className:m().planFingerprintMapItem,children:[(0,l.jsxs)("strong",{children:["Plan ",n,":"]}),(0,l.jsx)("pre",{className:m().planFingerprintMapPlan,children:t})]},n)})})]}):null;function R(e){let{results:t=[],preparationResults:n=[],planCount:s,planFingerprintByCombination:r}=e,[i,o]=(0,a.useState)(!1),[u,c]=(0,a.useState)(!1),p=t.length>0||n.length>0;return(0,l.jsxs)("div",{className:m().resultBox,children:[(0,l.jsx)(v,{planFingerprintByCombination:r}),(0,l.jsx)(E,{planCount:s}),(0,l.jsx)(I,{}),p?(0,l.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:0,marginTop:24},children:[(0,l.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center"},onClick:()=>o(e=>!e),children:[(0,l.jsx)(f,{open:i}),(0,l.jsx)("strong",{className:m().resultTitle,children:"Detailed Preparation Steps"})]}),i&&(0,l.jsx)("div",{className:m().resultContent,children:n.length>0?(0,l.jsx)("ul",{className:m().resultList,children:n.map((e,t)=>(0,l.jsx)("li",{className:m().resultItem,children:(0,l.jsx)("pre",{className:m().preparation,children:e})},t))}):(0,l.jsx)("span",{className:m().noPreparationResult,children:"No preparation steps"})}),(0,l.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",marginTop:8},onClick:()=>c(e=>!e),children:[(0,l.jsx)(f,{open:u}),(0,l.jsx)("strong",{className:m().resultTitle,children:"Detailed SQL Queries"})]}),u&&(0,l.jsx)("div",{className:m().resultContent,children:0===t.length?(0,l.jsx)("span",{className:m().noResult,children:"No result"}):(0,l.jsx)("ul",{className:m().resultList,children:t.map((e,t)=>(0,l.jsx)("li",{className:m().resultItem,children:(0,l.jsx)("span",{className:m().sql,children:e})},t))})})]}):(0,l.jsx)("div",{className:m().noResult,style:{textAlign:"center"},children:"Please execute a query"})]})}I.displayName="PlanFingerprintMapList";var L=n(8334),C=n.n(L);function F(){let[e,t]=(0,a.useState)(!1),[n,s]=(0,a.useState)(0),[r,o]=(0,a.useState)(5e4),[u,_]=(0,a.useState)(0),[m,x]=(0,a.useState)(10),[h,N]=(0,a.useState)([]),[S,b]=(0,a.useState)([]),[f,v]=(0,a.useState)(!0),[E,I]=(0,a.useState)(!0),[L,F]=(0,a.useState)(!0),[q,M]=(0,a.useState)(!0),[P,A]=(0,a.useState)(p),[T,O]=(0,a.useState)(2500),[B,k]=(0,a.useState)(1),[w,D]=(0,a.useState)(c),[Q,V]=(0,a.useState)(!1),[H,J]=(0,a.useState)(0),[G,Z]=(0,a.useState)({});async function z(){V(!0),Z({}),y();let t=await j({dim1Active:e,start0:n,end0:r,step0:T,start1:u,end1:m,step1:B,sqlQuery:P,preparation:w});b(t.preparationResults),N(t.sqlResults),J(g.size),Z(t.planFingerprintByCombination),V(!1)}return(0,l.jsxs)("div",{className:C().container,children:[(0,l.jsx)("h1",{className:C().heading,children:"PostgreSQL Query Plan Explorer"}),(0,l.jsx)(i,{label:"Dimension 0",start:n,end:r,setStart:s,setEnd:o,startValid:f,setStartValid:v,endValid:E,setEndValid:I,step:T,setStep:O}),e?(0,l.jsxs)("div",{children:[(0,l.jsx)(i,{label:"Dimension 1",start:u,end:m,setStart:_,setEnd:x,startValid:L,setStartValid:F,endValid:q,setEndValid:M,step:B,setStep:k}),(0,l.jsx)("button",{onClick:()=>t(!1),className:C().buttonRemove,children:"– Remove Dimension 1"})]}):(0,l.jsx)("button",{onClick:()=>t(!0),className:C().buttonAdd,children:"+ Add Dimension 1"}),(0,l.jsx)("div",{style:{marginBottom:24},children:(0,l.jsx)(d,{value:P,onChange:A,dim1Active:e,preparationValue:w,onPreparationChange:D})}),(0,l.jsxs)("div",{style:{display:"flex",gap:16,justifyContent:"center",marginBottom:16},children:[(0,l.jsx)("button",{onClick:z,className:C().buttonPrimary,disabled:Q||!f||!E||e&&(!L||!q)||""===P.trim(),children:Q?(0,l.jsx)("span",{className:C().spinner,"aria-label":"Loading"}):"Execute"}),(0,l.jsx)("button",{onClick:()=>{N([]),b([]),D(c),A(p),t(!1),Z({}),y()},className:C().buttonReset,children:"Reset"}),(0,l.jsx)("button",{onClick:()=>{N([]),b([]),D(""),A(""),Z({}),y()},className:C().buttonClear,children:"Clear"})]}),(0,l.jsx)(R,{results:h,preparationResults:S,planCount:H,planFingerprintByCombination:G})]})}},3681:(e,t,n)=>{Promise.resolve().then(n.bind(n,1883))},3876:e=>{e.exports={resultBox:"ResultList_resultBox__7VdAH",resultTitle:"ResultList_resultTitle__pEBQd",resultContent:"ResultList_resultContent__e0zMT",resultList:"ResultList_resultList__l8npF",resultItem:"ResultList_resultItem__khMHP",sql:"ResultList_sql__LOTVk",noResult:"ResultList_noResult__Si0zi",noPreparationResult:"ResultList_noPreparationResult___C8rk",preparation:"ResultList_preparation__7rt90",planCount:"ResultList_planCount__Fm79l",collapseButton:"ResultList_collapseButton__aFGQg",planFingerprintMapBox:"ResultList_planFingerprintMapBox__787t6",planFingerprintMapList:"ResultList_planFingerprintMapList__T7Zm0",planFingerprintMapItem:"ResultList_planFingerprintMapItem__HPX0W",planFingerprintMapPlan:"ResultList_planFingerprintMapPlan__ZYZRO"}},6677:e=>{e.exports={intervalRow:"IntervalSelector_intervalRow__vhTVf",inputLabel:"IntervalSelector_inputLabel__Ju7_S",inputField:"IntervalSelector_inputField__ANvAB",inputFieldInvalid:"IntervalSelector_inputFieldInvalid__jtJTc",intervalInfo:"IntervalSelector_intervalInfo__JbWZa"}},8334:e=>{e.exports={container:"page_container__aoG4z",heading:"page_heading__ZPgh_",resultBox:"page_resultBox__evpxF",resultTitle:"page_resultTitle__nINtY",resultList:"page_resultList__ZBU6J",resultItem:"page_resultItem__jRIk2",buttonPrimary:"page_buttonPrimary__QtCGm",buttonAdd:"page_buttonAdd__2sSdl",buttonRemove:"page_buttonRemove__HiRAG",buttonClear:"page_buttonClear__KywYs",buttonReset:"page_buttonReset__fgRUt",noResult:"page_noResult___U4Gg",spinner:"page_spinner__1WnEQ",spin:"page_spin__W_8_q"}}},e=>{var t=t=>e(e.s=t);e.O(0,[991,210,774,441,684,358],()=>t(3681)),_N_E=e.O()}]);