(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[974],{131:e=>{e.exports={sqlBox:"SqlQueryInput_sqlBox__aXeGu",sqlLabel:"SqlQueryInput_sqlLabel__jEOgL",sqlTextarea:"SqlQueryInput_sqlTextarea__FNuM_",sqlHint:"SqlQueryInput_sqlHint__TQLcQ",sqlPlaceholderBtn:"SqlQueryInput_sqlPlaceholderBtn__iM5CO"}},1883:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>F});var a=n(5155),l=n(2115),s=n(6677),r=n.n(s);function i(e){let{label:t,start:n,end:s,setStart:i,setEnd:o,startValid:u,setStartValid:p,endValid:c,setEndValid:d,step:m,setStep:_,description:x,setDescription:h}=e,[g,N]=l.useState(n.toString()),[S,y]=l.useState(s.toString()),[j,b]=l.useState(m.toString()),[f,v]=l.useState(!0),[E,R]=l.useState(x);l.useEffect(()=>{N(n.toString())},[n]),l.useEffect(()=>{y(s.toString())},[s]),l.useEffect(()=>{b(m.toString())},[m]),l.useEffect(()=>{R(x)},[x]);let I=e=>""!==e&&"-"!==e&&/^-?\d+$/.test(e),L=e=>""!==e&&/^\d*\.?\d+$/.test(e)&&Number(e)>0,F=(e,t)=>!(I(e)&&I(t))||Number(t)>Number(e);return(0,a.jsxs)("div",{className:r().intervalRow,children:[(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsxs)("span",{children:[t," Start:"]}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:g,onChange:e=>{let t=e.target.value;N(t);let n=I(t);p(n),n&&I(S)&&d(I(S)&&F(t,S)),n&&i(Number(t))},className:u?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsx)("span",{children:"End:"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:S,onChange:e=>{let t=e.target.value;y(t);let n=I(t)&&F(g,t);d(n),I(g)&&p(I(g)),n&&o(Number(t))},className:c?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid)})]}),(0,a.jsxs)("label",{className:r().inputLabel,children:[(0,a.jsx)("span",{children:"Step:"}),(0,a.jsx)("input",{type:"text",inputMode:"numeric",value:j,onChange:e=>{let t=e.target.value;b(t);let n=L(t);v(n),n&&_(Number(t))},className:f?r().inputField:"".concat(r().inputField," ").concat(r().inputFieldInvalid),min:1})]}),(0,a.jsxs)("label",{className:r().inputLabel,style:{marginLeft:8},children:[(0,a.jsx)("span",{children:"Description:"}),(0,a.jsx)("input",{type:"text",value:E,onChange:e=>{let t=e.target.value;R(t),h(t)},className:r().inputField})]})]})}var o=n(131),u=n.n(o);let p="SET enable_seqscan = on;\nSET cpu_index_tuple_cost = 0.0005;\nCREATE TABLE data(key integer, value text);\nINSERT INTO data (key, value) SELECT i, i::text FROM generate_series(1, 100000) i;\nCREATE INDEX ON data(key);\nANALYZE data;",c="SELECT * FROM data WHERE key > %%DIMENSION0%%;";function d(e){let{value:t,onChange:n,dim1Active:s,preparationValue:r,onPreparationChange:i}=e,o=(0,l.useRef)(null),p=e=>{let a=o.current;if(!a)return;let l=a.selectionStart,s=a.selectionEnd;n(t.slice(0,l)+e+t.slice(s)),setTimeout(()=>{a.focus(),a.selectionStart=a.selectionEnd=l+e.length},0)};return(0,a.jsxs)("div",{className:u().sqlBox,children:[(0,a.jsx)("label",{htmlFor:"preparation-steps",className:u().sqlLabel,children:"Preparation Steps"}),(0,a.jsx)("textarea",{id:"preparation-steps",value:r,onChange:e=>i(e.target.value),rows:7,className:u().sqlTextarea,placeholder:"Describe any preparation steps here..."}),(0,a.jsx)("label",{htmlFor:"sql-query",className:u().sqlLabel,children:"SQL Query"}),(0,a.jsx)("textarea",{id:"sql-query",ref:o,value:t,onChange:e=>n(e.target.value),rows:3,className:u().sqlTextarea,placeholder:"Enter your SQL query here..."}),(0,a.jsxs)("div",{className:u().sqlHint,children:["You can use the placeholder"," ",(0,a.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>p("%%DIMENSION0%%"),children:"%%DIMENSION0%%"}),s&&(0,a.jsxs)(a.Fragment,{children:[" ","and"," ",(0,a.jsx)("button",{type:"button",className:u().sqlPlaceholderBtn,onClick:()=>p("%%DIMENSION1%%"),children:"%%DIMENSION1%%"})]})," ","in your query."]})]})}var m=n(3876),_=n.n(m),x=n(5028),h=n(9967);let g=new Map,N=1;function S(){g.clear(),N=1}async function y(e){let{dim1Active:t,start0:n,end0:a,step0:l,start1:s,end1:r,step1:i,sqlQuery:o,preparation:u}=e,p=[],c=[],d={},m=e=>e.trim().toUpperCase().startsWith("SELECT"),_=e=>e.split(";").map(e=>e.trim()).filter(Boolean),x=new h.Eb;if(u)for(let e of _(u))try{let t=await x.query(e);p.push("".concat(e,";\nResult: ").concat(JSON.stringify(t,null,2)))}catch(t){p.push("".concat(e,";\nError: ").concat(t))}let S=async(e,t)=>{for(let n of _(e)){let e=n,a=!1;m(n)&&(e="EXPLAIN (FORMAT JSON) ".concat(n),a=!0);try{let n=await x.query(e);if(a)try{let e=n.rows,a=Array.isArray(e)&&e.length>0?e[0]:void 0,l=a&&Object.values(a)[0];l&&function(e,t){let n,a=function(e){let t=[];return Array.isArray(e)&&e.length>0&&e[0].Plan&&function e(t,n){if(!t||"object"!=typeof t)return;let a="string"==typeof t["Node Type"]?t["Node Type"]:void 0,l="string"==typeof t.Alias?t.Alias:void 0,s="string"==typeof t["Relation Name"]?t["Relation Name"]:void 0;if(a){let e=a;(l||s)&&(e+="(",l?e+=l:s&&(e+=s),e+=")"),n.push(e)}for(let a in t){let l=t[a];Array.isArray(l)?l.forEach(t=>e(t,n)):"object"==typeof l&&null!==l&&e(l,n)}}(e[0].Plan,t),t.join(">")}(e);g.has(a)?n=g.get(a):(n=N++,g.set(a,n)),t&&(d[t]=n),window.console.log("Plan fingerprint:",a,"ID:",n)}(l,t)}catch(e){window.console.log("Explain JSON parse error:",e)}c.push("".concat(e,";\nResult: ").concat(JSON.stringify(n,null,2)))}catch(t){c.push("".concat(e,";\nError: ").concat(t))}}};if(t)for(let e=n;e<=a+1e-8;e+=l){let t=Number(e.toFixed(8));for(let e=s;e<=r+1e-8;e+=i){let n=Number(e.toFixed(8)),a=o.replaceAll("%%DIMENSION0%%",t.toString()).replaceAll("%%DIMENSION1%%",n.toString()),l="".concat(t,",").concat(n);await S(a,l)}}else for(let e=n;e<=a+1e-8;e+=l){let t=Number(e.toFixed(8)),n=o.replaceAll("%%DIMENSION0%%",t.toString()).replaceAll("%%DIMENSION1%%",""),a="".concat(t,",0");await S(n,a)}return{preparationResults:p,sqlResults:c,planFingerprintByCombination:d}}let j=(0,x.default)(()=>Promise.all([n.e(776),n.e(699)]).then(n.bind(n,8699)),{loadableGenerated:{webpack:()=>[8699]},ssr:!1}),b=l.memo(e=>{let{open:t}=e;return(0,a.jsx)("span",{style:{display:"inline-block",transition:"transform 0.2s",transform:t?"rotate(90deg)":"rotate(0deg)",marginRight:6},children:"▶"})});b.displayName="Arrow";let f=e=>{let{planFingerprintByCombination:t,dim0Name:n,dim1Name:l}=e;if(!t||0===Object.keys(t).length)return null;let s=Object.keys(t),r=new Set;s.forEach(e=>{let[,t]=e.split(",").map(Number);r.add(t)});let i=Math.max(0,Array.from(r).length-10),{series:o,options:u}=function(e,t,n){let a=Object.keys(e),l=new Set,s=new Set;a.forEach(e=>{let[t,n]=e.split(",").map(Number);l.add(t),s.add(n)});let r=Array.from(l).sort((e,t)=>e-t),i=Array.from(s).sort((e,t)=>e-t),o=i.map(()=>r.map(()=>0));return a.forEach(t=>{let[n,a]=t.split(",").map(Number),l=i.indexOf(a),s=r.indexOf(n);o[l][s]=e[t]}),{series:o.map((e,t)=>({name:"".concat(i[t]),data:e})),options:{chart:{type:"heatmap"},dataLabels:{enabled:!1},xaxis:{categories:r.map(e=>e.toString()),title:{text:t}},yaxis:i.length>1?{title:{text:n}}:{show:!1},grid:{padding:{left:5,right:5,bottom:5,top:5}},colors:["#008FFB"],title:{text:"Plan Fingerprint Heatmap"}}}}(t,n,l);return(0,a.jsx)("div",{style:{margin:"24px 0"},children:(0,a.jsx)(j,{options:u,series:o,type:"heatmap",height:350+15*i})})};f.displayName="Heatmap";let v=e=>{let{planCount:t}=e;return void 0!==t&&g.size>0?(0,a.jsxs)("div",{className:_().planCount,children:["Number of different plans: ",t]}):null},E=()=>g.size>0?(0,a.jsxs)("div",{className:_().planFingerprintMapBox,children:[(0,a.jsx)("h3",{children:(0,a.jsx)("strong",{children:"Plan Fingerprints"})}),(0,a.jsx)("ul",{className:_().planFingerprintMapList,children:[...g.entries()].map(e=>{let[t,n]=e;return(0,a.jsxs)("li",{className:_().planFingerprintMapItem,children:[(0,a.jsxs)("strong",{children:["Plan ",n,":"]}),(0,a.jsx)("pre",{className:_().planFingerprintMapPlan,children:t})]},n)})})]}):null;function R(e){let{results:t=[],preparationResults:n=[],planCount:s,planFingerprintByCombination:r,dim0Name:i,dim1Name:o}=e,[u,p]=(0,l.useState)(!1),[c,d]=(0,l.useState)(!1),m=t.length>0||n.length>0;return(0,a.jsxs)("div",{className:_().resultBox,children:[(0,a.jsx)(f,{planFingerprintByCombination:r,dim0Name:i,dim1Name:o}),(0,a.jsx)(v,{planCount:s}),(0,a.jsx)(E,{}),m?(0,a.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:0,marginTop:24},children:[(0,a.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center"},onClick:()=>p(e=>!e),children:[(0,a.jsx)(b,{open:u}),(0,a.jsx)("strong",{className:_().resultTitle,children:"Detailed Preparation Steps"})]}),u&&(0,a.jsx)("div",{className:_().resultContent,children:n.length>0?(0,a.jsx)("ul",{className:_().resultList,children:n.map((e,t)=>(0,a.jsx)("li",{className:_().resultItem,children:(0,a.jsx)("pre",{className:_().preparation,children:e})},t))}):(0,a.jsx)("span",{className:_().noPreparationResult,children:"No preparation steps"})}),(0,a.jsxs)("div",{style:{cursor:"pointer",userSelect:"none",display:"flex",alignItems:"center",marginTop:8},onClick:()=>d(e=>!e),children:[(0,a.jsx)(b,{open:c}),(0,a.jsx)("strong",{className:_().resultTitle,children:"Detailed SQL Queries"})]}),c&&(0,a.jsx)("div",{className:_().resultContent,children:0===t.length?(0,a.jsx)("span",{className:_().noResult,children:"No result"}):(0,a.jsx)("ul",{className:_().resultList,children:t.map((e,t)=>(0,a.jsx)("li",{className:_().resultItem,children:(0,a.jsx)("span",{className:_().sql,children:e})},t))})})]}):(0,a.jsx)("div",{className:_().noResult,style:{textAlign:"center"},children:"Please execute a query"})]})}E.displayName="PlanFingerprintMapList";var I=n(8334),L=n.n(I);function F(){let[e,t]=(0,l.useState)(!1),[n,s]=(0,l.useState)(0),[r,o]=(0,l.useState)(5e4),[u,m]=(0,l.useState)(0),[_,x]=(0,l.useState)(10),[h,N]=(0,l.useState)([]),[j,b]=(0,l.useState)([]),[f,v]=(0,l.useState)(!0),[E,I]=(0,l.useState)(!0),[F,C]=(0,l.useState)(!0),[q,M]=(0,l.useState)(!0),[A,P]=(0,l.useState)(c),[T,O]=(0,l.useState)(2500),[B,k]=(0,l.useState)(1),[w,D]=(0,l.useState)(p),[Q,V]=(0,l.useState)(!1),[H,J]=(0,l.useState)(0),[G,Z]=(0,l.useState)({}),z="Dimension 0",W="Dimension 1",[Y,U]=(0,l.useState)(z),[X,$]=(0,l.useState)(W);async function K(){V(!0),Z({}),S();let t=await y({dim1Active:e,start0:n,end0:r,step0:T,start1:u,end1:_,step1:B,sqlQuery:A,preparation:w});b(t.preparationResults),N(t.sqlResults),J(g.size),Z(t.planFingerprintByCombination),V(!1)}return(0,a.jsxs)("div",{className:L().container,children:[(0,a.jsx)("h1",{className:L().heading,children:"PostgreSQL Query Plan Explorer"}),(0,a.jsx)(i,{label:"Dimension 0",start:n,end:r,setStart:s,setEnd:o,startValid:f,setStartValid:v,endValid:E,setEndValid:I,step:T,setStep:O,description:Y,setDescription:U}),e?(0,a.jsxs)("div",{children:[(0,a.jsx)(i,{label:"Dimension 1",start:u,end:_,setStart:m,setEnd:x,startValid:F,setStartValid:C,endValid:q,setEndValid:M,step:B,setStep:k,description:X,setDescription:$}),(0,a.jsx)("button",{onClick:()=>t(!1),className:L().buttonRemove,children:"– Remove Dimension 1"})]}):(0,a.jsx)("button",{onClick:()=>t(!0),className:L().buttonAdd,children:"+ Add Dimension 1"}),(0,a.jsx)("div",{style:{marginBottom:24},children:(0,a.jsx)(d,{value:A,onChange:P,dim1Active:e,preparationValue:w,onPreparationChange:D})}),(0,a.jsxs)("div",{style:{display:"flex",gap:16,justifyContent:"center",marginBottom:16},children:[(0,a.jsx)("button",{onClick:K,className:L().buttonPrimary,disabled:Q||!f||!E||e&&(!F||!q)||""===A.trim(),children:Q?(0,a.jsx)("span",{className:L().spinner,"aria-label":"Loading"}):"Execute"}),(0,a.jsx)("button",{onClick:()=>{N([]),b([]),D(p),P(c),t(!1),Z({}),S(),U(z),$(W)},className:L().buttonReset,children:"Reset"}),(0,a.jsx)("button",{onClick:()=>{N([]),b([]),D(""),P(""),Z({}),S(),U(z),$(W)},className:L().buttonClear,children:"Clear"})]}),(0,a.jsx)(R,{results:h,preparationResults:j,planCount:H,planFingerprintByCombination:G,dim0Name:Y,dim1Name:X})]})}},3681:(e,t,n)=>{Promise.resolve().then(n.bind(n,1883))},3876:e=>{e.exports={resultBox:"ResultList_resultBox__7VdAH",resultTitle:"ResultList_resultTitle__pEBQd",resultContent:"ResultList_resultContent__e0zMT",resultList:"ResultList_resultList__l8npF",resultItem:"ResultList_resultItem__khMHP",sql:"ResultList_sql__LOTVk",noResult:"ResultList_noResult__Si0zi",noPreparationResult:"ResultList_noPreparationResult___C8rk",preparation:"ResultList_preparation__7rt90",planCount:"ResultList_planCount__Fm79l",collapseButton:"ResultList_collapseButton__aFGQg",planFingerprintMapBox:"ResultList_planFingerprintMapBox__787t6",planFingerprintMapList:"ResultList_planFingerprintMapList__T7Zm0",planFingerprintMapItem:"ResultList_planFingerprintMapItem__HPX0W",planFingerprintMapPlan:"ResultList_planFingerprintMapPlan__ZYZRO"}},6677:e=>{e.exports={intervalRow:"IntervalSelector_intervalRow__vhTVf",inputLabel:"IntervalSelector_inputLabel__Ju7_S",inputField:"IntervalSelector_inputField__ANvAB",inputFieldInvalid:"IntervalSelector_inputFieldInvalid__jtJTc",intervalInfo:"IntervalSelector_intervalInfo__JbWZa"}},8334:e=>{e.exports={container:"page_container__aoG4z",heading:"page_heading__ZPgh_",resultBox:"page_resultBox__evpxF",resultTitle:"page_resultTitle__nINtY",resultList:"page_resultList__ZBU6J",resultItem:"page_resultItem__jRIk2",buttonPrimary:"page_buttonPrimary__QtCGm",buttonAdd:"page_buttonAdd__2sSdl",buttonRemove:"page_buttonRemove__HiRAG",buttonClear:"page_buttonClear__KywYs",buttonReset:"page_buttonReset__fgRUt",noResult:"page_noResult___U4Gg",spinner:"page_spinner__1WnEQ",spin:"page_spin__W_8_q"}}},e=>{var t=t=>e(e.s=t);e.O(0,[991,210,774,441,684,358],()=>t(3681)),_N_E=e.O()}]);